<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daily Challenge</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap');

        :root {
            --bg-color: #0b0c10;
            --card-bg: #1e1f25;
            --primary: #4b69ff;
            --primary-gradient: linear-gradient(135deg, #4b69ff 0%, #8847ff 100%);
            --gold-gradient: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            --text-main: #ffffff;
            --grad-blue: linear-gradient(135deg, #4b69ff 0%, #3d5afe 100%);
        }

        body {
            margin: 0; padding: 16px;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Montserrat', sans-serif;
            -webkit-tap-highlight-color: transparent;
            min-height: 100vh;
            padding-bottom: 40px;
            overflow-x: hidden;
        }

        .header h1 { 
            font-size: 22px; font-weight: 800; margin: 0 0 20px 0; text-transform: uppercase; 
            background: linear-gradient(90deg, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* --- –ï–î–ò–ù–´–ô –°–¢–ò–õ–¨ –ö–ù–û–ü–û–ö-–ü–õ–ê–®–ï–ö --- */
        .action-card {
            width: 100%;
            height: 64px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            border-radius: 14px;
            border: none;
            font-weight: 700;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between; /* –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç */
            padding: 0 20px;
            margin-bottom: 10px;
            cursor: pointer;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            transition: transform 0.1s;
        }
        .action-card:active { transform: scale(0.98); }

        /* 1. –ö–Ω–æ–ø–∫–∞ –ù–ê–ß–ê–¢–¨ */
        .btn-start {
            background: #4b69ff;
            box-shadow: 0 4px 15px rgba(75, 105, 255, 0.3);
            color: #fff;
            justify-content: center; /* –ü–æ —Ü–µ–Ω—Ç—Ä—É –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ä—Ç */
            gap: 10px;
        }

        /* 2. –ö–Ω–æ–ø–∫–∞ –ê–ö–¢–ò–í–ù–û–ì–û –ó–ê–î–ê–ù–ò–Ø (–ü—Ä–æ–≥—Ä–µ—Å—Å) */
        .btn-status {
            background: #1e1f25;
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
        }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤–Ω—É—Ç—Ä–∏ –∫–Ω–æ–ø–∫–∏ */
        .status-progress-bg {
            position: absolute; bottom: 0; left: 0; height: 3px; width: 100%;
            background: rgba(255,255,255,0.1);
        }
        .status-progress-fill {
            height: 100%; background: #4b69ff; transition: width 0.5s;
            box-shadow: 0 0 10px #4b69ff;
        }

        /* 3. –ö–Ω–æ–ø–∫–∞ –ü–û–î–†–û–ë–ù–ï–ï */
        .btn-details {
            background: rgba(255,255,255,0.05);
            border: 1px dashed rgba(255,255,255,0.15);
            color: #aaa;
            justify-content: center;
            gap: 8px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-details:active { background: rgba(255,255,255,0.08); }

        /* 4. –ö–Ω–æ–ø–∫–∞ –ó–ê–ë–†–ê–¢–¨ (–ì–æ—Ç–æ–≤–æ) */
        .btn-claim {
            background: var(--gold-gradient);
            color: #000;
            justify-content: center;
            animation: pulse-gold 2s infinite;
        }

        /* --- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û (–ü–û–î–†–û–ë–ù–ï–ï) --- */
        .details-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 5000;
            display: flex; align-items: flex-end;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .details-modal.visible { opacity: 1; pointer-events: auto; }
        
        .details-content {
            background: #15161b;
            width: 100%;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.6);
            transform: translateY(100%); transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 50px; /* Safe area */
        }
        .details-modal.visible .details-content { transform: translateY(0); }

        .dm-title { font-size: 20px; font-weight: 800; color: #fff; margin-bottom: 20px; }
        .dm-row {
            display: flex; gap: 15px; margin-bottom: 15px;
            background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px;
        }
        .dm-icon { width: 24px; color: #4b69ff; font-size: 18px; text-align: center; }
        .dm-text { font-size: 13px; color: #ccc; line-height: 1.4; }
        .dm-highlight { color: #fff; font-weight: 700; }
        
        .btn-close-modal {
            width: 100%; padding: 16px; background: #2d2f36; color: #fff;
            border: none; border-radius: 12px; font-weight: 700; font-size: 14px;
            margin-top: 10px; cursor: pointer;
        }

        /* --- ROULETTE (FIXED) --- */
        .r-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; display: none; justify-content: center; align-items: center; flex-direction: column; backdrop-filter: blur(10px); }
        .r-game-area { width: 100%; height: 200px; position: relative; overflow: hidden; border-top: 1px solid #333; border-bottom: 1px solid #333; background: rgba(20,20,20,0.5); }
        
        /* –õ–∏–Ω–∏—è –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        .r-marker-line { 
            position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; 
            background: #ffd700; transform: translateX(-50%); z-index: 20; 
            box-shadow: 0 0 15px #ffd700;
        }
        .r-marker-triangle {
            position: absolute; left: 50%; top: -5px; transform: translateX(-50%);
            width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 15px solid #ffd700; z-index: 21;
        }

        .r-track { display: flex; height: 100%; align-items: center; will-change: transform; }
        
        /* 140px —à–∏—Ä–∏–Ω–∞ + 4px margin —Å–ª–µ–≤–∞ + 4px margin —Å–ø—Ä–∞–≤–∞ = 148px –®–ê–ì */
        .r-card { 
            width: 140px; height: 140px; 
            margin: 0 4px; 
            background: #1a1b20; border-radius: 12px; 
            flex-shrink: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border: 2px solid rgba(255,255,255,0.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3); 
        }
        .r-card img { width: 90px; height: 60px; object-fit: contain; }
        .r-card-name { font-size:10px; color:#888; margin-top:10px; max-width: 90%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* –¶–≤–µ—Ç–∞ —Ä–µ–¥–∫–æ—Å—Ç–∏ */
        .r-blue { border-color: #4b69ff; background: radial-gradient(circle, rgba(75,105,255,0.15), #1a1b20); }
        .r-purple { border-color: #8847ff; background: radial-gradient(circle, rgba(136,71,255,0.15), #1a1b20); }
        .r-pink { border-color: #d32ce6; background: radial-gradient(circle, rgba(211,44,230,0.15), #1a1b20); }
        .r-gold { border-color: #ffd700; background: radial-gradient(circle, rgba(255,215,0,0.15), #1a1b20); }

        .win-screen { display: none; text-align: center; animation: fadeIn 0.5s; padding: 20px; z-index: 100; width: 100%; box-sizing: border-box;}
        .win-img { width: 180px; filter: drop-shadow(0 0 30px rgba(255,215,0,0.5)); animation: float 3s infinite ease-in-out; margin: 20px 0;}
        
        @keyframes pulse-gold { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-15px)} }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Alert */
        .custom-alert-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; }
        .custom-alert-overlay.visible { opacity: 1; pointer-events: auto; }
        .custom-alert-box { background: #1e1f25; width: 280px; padding: 25px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1); transform: scale(0.9); transition: 0.3s; }
        .custom-alert-overlay.visible .custom-alert-box { transform: scale(1); }

    </style>
</head>
<body>

    <div class="header">
        <h1>–î–Ω–µ–≤–Ω–∞—è –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h1>
    </div>

    <div id="app">
        <div style="text-align:center; padding-top:50px; color:#666;">
            <i class="fa-solid fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>
    </div>

    <div id="details-modal" class="details-modal">
        <div class="details-content">
            <div class="dm-title" id="dm-title">–ó–∞–¥–∞–Ω–∏–µ</div>
            
            <div class="dm-row">
                <div class="dm-icon"><i class="fa-solid fa-gift"></i></div>
                <div class="dm-text">
                    <span style="color:#888; text-transform:uppercase; font-size:10px;">–¢–µ–∫—É—â–∞—è –Ω–∞–≥—Ä–∞–¥–∞</span><br>
                    <span id="dm-reward" class="dm-highlight" style="font-size:16px;">--</span>
                </div>
            </div>

            <div class="dm-row">
                <div class="dm-icon"><i class="fa-solid fa-layer-group"></i></div>
                <div class="dm-text">
                    <span style="color:#888; text-transform:uppercase; font-size:10px;">–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø</span><br>
                    <span id="dm-next" class="dm-highlight">--</span>
                </div>
            </div>

            <div class="dm-row">
                <div class="dm-icon"><i class="fa-solid fa-circle-info"></i></div>
                <div class="dm-text">
                    –ü—Ä–∞–≤–∏–ª–∞:<br>
                    ‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ <a href="#" onclick="openChat(); return false;" style="color:#fff;">HATElove</a><br>
                    ‚Ä¢ –ù–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤<br>
                    ‚Ä¢ –ë–µ–∑ —Å–ø–∞–º–∞
                </div>
            </div>

            <button class="btn-close-modal" onclick="closeDetails()">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <div id="r-modal" class="r-modal-overlay">
        <div id="r-area" class="r-game-area">
            <div class="r-marker-line"></div>
            <div class="r-marker-triangle"></div>
            <div class="r-track" id="r-track"></div>
        </div>
        <div id="r-win" class="win-screen">
            <h2 style="color:#ffd700; margin:0;">–í–´–ò–ì–†–´–®!</h2>
            <img id="r-win-img" class="win-img" src="">
            <div id="r-win-name" style="font-weight:700; font-size:18px;"></div>
            <button class="action-card btn-claim" style="margin-top:20px;" onclick="closeRoulette()">–ó–ê–ë–†–ê–¢–¨ –í –ò–ù–í–ï–ù–¢–ê–†–¨</button>
        </div>
    </div>

    <div id="custom-alert" class="custom-alert-overlay">
        <div class="custom-alert-box">
            <h3 id="alert-title" style="margin-top:0; color:#fff;"></h3>
            <p id="alert-msg" style="color:#aaa; font-size:14px; margin-bottom:20px;"></p>
            <button class="action-card btn-start" style="height:45px; font-size:14px;" onclick="closeCustomAlert()">–û–ö</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const haptic = tg.HapticFeedback;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–æ–¥–∞–ª–∫–∏
        let currentModalData = {};

        // 1. –°–£–¢–û–ß–ù–´–ô –°–ë–†–û–° (–õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
        function checkDailyReset() {
            const lastDate = localStorage.getItem('last_challenge_date');
            const today = new Date().toDateString(); // "Fri Oct 10 2025"

            if (lastDate && lastDate !== today) {
                // –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç, —ç—Ç–æ –Ω–æ–≤—ã–π –¥–µ–Ω—å.
                // –ú–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
                console.log("New day detected. Resetting view.");
                localStorage.removeItem('cached_challenge_status');
            }
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º "—Å–µ–≥–æ–¥–Ω—è" –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ (—Å–º. –Ω–∏–∂–µ)
        }
        checkDailyReset();

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã
        function fmtReward(r, type) {
            if (type === 'skin_random') return 'üî• –°–ª—É—á–∞–π–Ω—ã–π –°–∫–∏–Ω';
            if (typeof r === 'object') {
                return `${r.tickets||0}üéü ${r.coins||0}üí∞`;
            }
            if (type === 'coins') return `${r} üí∞`;
            return `${r} üéü`;
        }

        async function init() {
            // –≠–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π fetch)
            // fetch('/api/challenges')...
            // –î–ª—è —Ç–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º "—Ñ–µ–π–∫" –µ—Å–ª–∏ fetch –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
            
            try {
                // const res = await fetch('/api/challenges/list');
                // const data = await res.json();
                
                // –î–ï–ú–û –î–ê–ù–ù–´–ï (–£–î–ê–õ–ò –ü–†–ò –ü–†–û–î–ï, –ï–°–õ–ò –ï–°–¢–¨ API)
                const data = { challenges: [
                    { 
                        template_id: 1, 
                        title: "–ê–∫—Ç–∏–≤ –≤ —á–∞—Ç–µ", 
                        status: "active", // available, active, ready_to_claim, completed
                        current_progress: 45, 
                        target: 100, 
                        reward_amount: 1, 
                        reward_type: 'skin_random',
                        next_tier: { target: 250, reward: 500, type: 'coins' }
                    }
                ]};
                
                render(data.challenges);
            } catch(e) {
                document.getElementById('app').innerHTML = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏";
            }
        }

        function render(list) {
            const app = document.getElementById('app');
            app.innerHTML = '';

            list.forEach(item => {
                // –ü–†–û–í–ï–†–ö–ê –ù–ê –ù–û–í–´–ô –î–ï–ù–¨ (–ï–°–õ–ò –°–ï–†–í–ï–† –¢–£–ü–ò–¢, –ù–û –ú–´ –ó–ù–ê–ï–ú –ß–¢–û –ù–û–í–´–ô –î–ï–ù–¨)
                const today = new Date().toDateString();
                const lastDate = localStorage.getItem('last_challenge_date');
                if (item.status === 'completed' && lastDate !== today) {
                    item.status = 'available';
                    item.current_progress = 0;
                }

                if (item.status === 'available') {
                    // 1. –°–¢–ê–¢–£–°: –ù–ê–ß–ê–¢–¨ (–ö–æ–º–ø–∞–∫—Ç–Ω–æ)
                    const btn = document.createElement('div');
                    btn.className = 'action-card btn-start';
                    btn.innerHTML = `<i class="fa-solid fa-fire"></i> –ù–ê–ß–ê–¢–¨ –ò–°–ü–´–¢–ê–ù–ò–ï`;
                    btn.onclick = () => handleAction('start', item.template_id);
                    app.appendChild(btn);

                    // –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" —Ç–æ–∂–µ –Ω—É–∂–Ω–∞? –û–±—ã—á–Ω–æ –Ω–µ—Ç, –µ—Å–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –Ω–µ –≤–∑—è—Ç–æ, –Ω–æ –µ—Å–ª–∏ –Ω–∞–¥–æ - –¥–æ–±–∞–≤—å –Ω–∏–∂–µ.
                
                } else if (item.status === 'active' || item.status === 'ready_to_claim') {
                    // 2. –°–¢–ê–¢–£–°: –ê–ö–¢–ò–í–ù–û (–ö–æ–º–ø–∞–∫—Ç–Ω–æ + –ü–æ–¥—Ä–æ–±–Ω–µ–µ)
                    
                    if (item.status === 'ready_to_claim') {
                         const btnClaim = document.createElement('div');
                         btnClaim.className = 'action-card btn-claim';
                         btnClaim.innerHTML = `–ó–ê–ë–†–ê–¢–¨ –ù–ê–ì–†–ê–î–£`;
                         btnClaim.onclick = () => handleAction('claim', item.template_id);
                         app.appendChild(btnClaim);
                    } else {
                        // –ü–ª–∞—à–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                        const percent = (item.current_progress / item.target) * 100;
                        const statusBar = document.createElement('div');
                        statusBar.className = 'action-card btn-status';
                        statusBar.innerHTML = `
                            <div class="status-progress-bg"><div class="status-progress-fill" style="width:${percent}%"></div></div>
                            <span style="z-index:2; font-weight:700; font-size:14px; color:#fff;">${item.title}</span>
                            <span style="z-index:2; color:#aaa; font-size:12px;">${item.current_progress}/${item.target}</span>
                        `;
                        app.appendChild(statusBar);
                    }

                    // –ö–Ω–æ–ø–∫–∞ –ü–û–î–†–û–ë–ù–ï–ï (–°–Ω–∏–∑—É, –≤ —Ç–æ–º –∂–µ —Å—Ç–∏–ª–µ)
                    const btnInfo = document.createElement('div');
                    btnInfo.className = 'action-card btn-details';
                    btnInfo.innerHTML = `–£–ó–ù–ê–¢–¨ –ü–û–î–†–û–ë–ù–ï–ï <i class="fa-solid fa-chevron-right" style="font-size:10px;"></i>`;
                    
                    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–æ–¥–∞–ª–∫–∏
                    btnInfo.onclick = () => {
                        document.getElementById('dm-title').innerText = item.title;
                        document.getElementById('dm-reward').innerText = fmtReward(item.reward_amount, item.reward_type);
                        
                        const nextHtml = item.next_tier 
                            ? `<span style="color:#fff">${item.next_tier.target} —Å–æ–æ–±—â–µ–Ω–∏–π</span> = <span style="color:#ffd700">${fmtReward(item.next_tier.reward, item.next_tier.type)}</span>`
                            : "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å!";
                        document.getElementById('dm-next').innerHTML = nextHtml;
                        
                        openDetails();
                    };
                    app.appendChild(btnInfo);

                } else if (item.status === 'completed') {
                    const done = document.createElement('div');
                    done.className = 'action-card btn-details';
                    done.style.opacity = '0.5';
                    done.innerText = '–í–´–ü–û–õ–ù–ï–ù–û (–ñ–î–ï–ú –ó–ê–í–¢–†–ê)';
                    app.appendChild(done);
                }
            });
        }

        // --- –ú–û–î–ê–õ–ö–ê ---
        function openDetails() { document.getElementById('details-modal').classList.add('visible'); }
        function closeDetails() { document.getElementById('details-modal').classList.remove('visible'); }

        // --- ACTIONS ---
        async function handleAction(type, id) {
            haptic.impactOccurred('medium');
            
            if(type === 'start') {
                // –¢—É—Ç –∑–∞–ø—Ä–æ—Å –∫ API
                // await fetch('/api/start'...)
                
                // –§–µ–π–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∞
                alert("–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –Ω–∞—á–∞—Ç–æ!");
                location.reload(); 
            }

            if(type === 'claim') {
                // –ï—Å–ª–∏ –Ω–∞–≥—Ä–∞–¥–∞ - —Å–∫–∏–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º —Ä—É–ª–µ—Ç–∫—É
                // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ —Ä—É–ª–µ—Ç–∫–∏:
                const rouletteItems = [
                    {id:1, name:'AK-47 | Blue', image_url:'https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpot7HxfDhjxszJemkV092lnYmGm_7zN4Tck29Y_cg_3r_C9I_xjVax_kZtZ2_6JoWddVI5ZQrS8gW4xO_qjJ69u5rJz3Jj6CdxsSqPyhC_h0oaO_sv26Is8_1nkw', rarity:'blue'},
                    {id:2, name:'M4A4 | Poly', image_url:'https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpou-6kejhz2v_Nfz5H_uO1gb-Gw_alIITfn2xZ_Mhwd87Ot3v3gLZrNWn6J9CSdgM_YV_V8lfqx-7ug8XovZ_Mz3FmpGB8sr2f8X7L', rarity:'purple'},
                    {id:3, name:'AWP | Fade', image_url:'https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpot621FAR17PLfYQJD_9W7m5a0n_L1JaKfzzoGuJJ02e2W8d6m2gztrkRoZmigItDGcgA_YVzSq1K7xL_qjJ65vM7BmnI26nUl5yrZzRzm1xEMH5O9J02d', rarity:'gold'},
                ];
                // –í—ã–∏–≥—Ä–∞–ª AWP (–∏–Ω–¥–µ–∫—Å –±—É–¥–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω –Ω–∏–∂–µ)
                const winner = rouletteItems[2]; 

                launchRoulette(rouletteItems, winner);
                
                // –í–∞–∂–Ω–æ! –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞—Ç—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –∑–∞–≤—Ç—Ä–∞
                localStorage.setItem('last_challenge_date', new Date().toDateString());
            }
        }

        // --- ROULETTE LOGIC (FIXED & ANIMATED) ---
        function launchRoulette(items, winnerItem) {
            const modal = document.getElementById('r-modal');
            const track = document.getElementById('r-track');
            const winScreen = document.getElementById('r-win');
            const area = document.getElementById('r-area');
            
            modal.style.display = 'flex';
            area.style.display = 'block';
            winScreen.style.display = 'none';
            track.style.transition = 'none';
            track.style.transform = 'translateX(0px)';
            
            // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–ª–∏–Ω–Ω—É—é –ª–µ–Ω—Ç—É (—á—Ç–æ–±—ã –∫—Ä—É—Ç–∏–ª–æ—Å—å –¥–æ–ª–≥–æ)
            let list = [];
            for(let i=0; i<50; i++) list = list.concat(items); // –ú–Ω–æ–≥–æ –∫–æ–ø–∏–π
            
            // 2. –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–æ–∑–∏—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–Ω–¥–µ–∫—Å 60)
            const WIN_INDEX = 60;
            list[WIN_INDEX] = winnerItem;
            // –î–æ–±–∏–≤–∞–µ–º —Ö–≤–æ—Å—Ç
            for(let i=0; i<10; i++) list.push(items[i % items.length]);

            // –†–µ–Ω–¥–µ—Ä HTML
            track.innerHTML = list.map(item => {
                let rClass = 'r-blue';
                if(item.rarity==='purple') rClass='r-purple';
                if(item.rarity==='pink') rClass='r-pink';
                if(item.rarity==='gold') rClass='r-gold';
                return `<div class="r-card ${rClass}"><img src="${item.image_url}"><div class="r-card-name">${item.name}</div></div>`;
            }).join('');

            // --- –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê (Pixel Perfect) ---
            const cardWidth = 140; // –®–∏—Ä–∏–Ω–∞ CSS
            const margin = 8;      // 4px —Å–ª–µ–≤–∞ + 4px —Å–ø—Ä–∞–≤–∞
            const itemFullWidth = cardWidth + margin; // 148px
            
            const screenCenter = window.innerWidth / 2;
            
            // –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç–æ—á–∫–∏-–ø–æ–±–µ–¥–∏—Ç–µ–ª—è (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—á–∞–ª–∞ –ª–µ–Ω—Ç—ã)
            // (WIN_INDEX * 148) - —ç—Ç–æ –Ω–∞—á–∞–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏. + (148/2) - —ç—Ç–æ –µ—ë —Ü–µ–Ω—Ç—Ä.
            const winnerCenterPosition = (WIN_INDEX * itemFullWidth) + (itemFullWidth / 2);
            
            // –°–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ —Å–¥–≤–∏–Ω—É—Ç—å –≤–ª–µ–≤–æ, —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Å–æ–≤–ø–∞–ª —Å —Ü–µ–Ω—Ç—Ä–æ–º —ç–∫—Ä–∞–Ω–∞
            const targetTransform = -(winnerCenterPosition - screenCenter);
            
            // –†–ê–ù–î–û–ú (–ß—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å —á—É—Ç—å –ö–†–ò–í–û, –∞ –ø–æ—Ç–æ–º –≤—ã—Ä–æ–≤–Ω—è–ª–æ—Å—å)
            // –°–¥–≤–∏–≥ –æ—Ç -30px –¥–æ +30px –æ—Ç –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞
            const randomOffset = (Math.random() * 60) - 30; 
            const stopPosition = targetTransform + randomOffset;

            // --- –ê–ù–ò–ú–ê–¶–ò–Ø ---
            setTimeout(() => {
                // 1. –ë—ã—Å—Ç—Ä–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ (5 —Å–µ–∫—É–Ω–¥)
                track.style.transition = 'transform 5s cubic-bezier(0.1, 0, 0.2, 1)'; // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–º–µ–¥–ª–µ–Ω–∏—è –≤ –∫–æ–Ω—Ü–µ
                track.style.transform = `translateX(${stopPosition}px)`;
                
                // –•–∞–ø—Ç–∏–∫ –≤–æ –≤—Ä–µ–º—è –∫—Ä—É—á–µ–Ω–∏—è
                let hapticInterval = setInterval(() => haptic.selectionChanged(), 100);

                setTimeout(() => {
                    clearInterval(hapticInterval);
                    
                    // 2. "–î–û–í–û–î–ö–ê" (–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É)
                    // –ü–ª–∞–≤–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –∑–∞ 0.8 —Å–µ–∫, —á—Ç–æ–±—ã –ª–∏–Ω–∏—è –≤—Å—Ç–∞–ª–∞ —Ä–æ–≤–Ω–æ –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω—É —Å–∫–∏–Ω–∞
                    track.style.transition = 'transform 0.8s ease-in-out';
                    track.style.transform = `translateX(${targetTransform}px)`;
                    
                    haptic.impactOccurred('heavy'); // –£–¥–∞—Ä –ø—Ä–∏ —Ñ–∏–∫—Å–∞—Ü–∏–∏

                    // –ü–æ–∫–∞–∑ –ø–æ–±–µ–¥—ã
                    setTimeout(() => {
                        haptic.notificationOccurred('success');
                        area.style.display = 'none';
                        document.getElementById('r-win-img').src = winnerItem.image_url;
                        document.getElementById('r-win-name').innerText = winnerItem.name;
                        winScreen.style.display = 'block';
                    }, 1000);

                }, 5100); // –ñ–¥–µ–º —á—É—Ç—å –±–æ–ª—å—à–µ 5 —Å–µ–∫ (–≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ —Å–ø–∏–Ω–∞)
            }, 100);
        }

        function closeRoulette() {
            document.getElementById('r-modal').style.display = 'none';
            init();
        }
        
        function closeCustomAlert() {
             document.getElementById('custom-alert').classList.remove('visible');
        }
        
        function openChat() { tg.openTelegramLink('https://t.me/hatelovettv'); }

        // –ó–∞–ø—É—Å–∫
        init();

    </script>
</body>
</html>
