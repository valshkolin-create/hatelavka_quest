<!DOCTYPE html> 
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ó–∞–¥–∞–Ω–∏—è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <script>
    // –ó–∞–≥–ª—É—à–∫–∞ Telegram, –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –ø—Ä–æ–≥—Ä—É–∑–∏–ª—Å—è
    if (typeof Telegram === 'undefined') {
      window.Telegram = {
        WebApp: {
          initData: '',
          initDataUnsafe: {},
          ready: function() { console.log('Telegram Mock Ready'); },
          expand: function() { console.log('Telegram Mock Expand'); },
          close: function() {},
          showAlert: function(msg) { alert(msg); },
          showConfirm: function(msg, cb) { if(cb) cb(confirm(msg)); },
          openLink: function(url) { window.open(url, '_blank'); },
          openTelegramLink: function(url) { window.open(url, '_blank'); },
          HapticFeedback: { notificationOccurred: function() {}, impactOccurred: function() {} }
        }
      };
    }
  </script>
  <link rel="stylesheet" href="/fontawesome/css/all.min.css" />
  <link rel="stylesheet" href="/quests.css?v=2" />
</head>
<body>
  
  <div id="loader-overlay" style="display: flex; flex-direction: column; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999;">
    <div class="spinner"></div>
    <div id="loading-text" style="color: #fff; margin-top: 15px; font-family: sans-serif; font-weight: bold; font-size: 18px;">0%</div>
    <div style="width: 200px; height: 4px; background: #333; border-radius: 2px; margin-top: 10px; overflow: hidden;">
        <div id="loading-bar-fill" style="width: 0%; height: 100%; background: #007aff; transition: width 0.3s ease;"></div>
    </div>
  </div>

  <main id="main-content" class="main-content">
    
    <div id="pull-to-refresh">
        <i class="fa-solid fa-rotate-right"></i> 
    </div>

    <div class="user-profile" style="margin-bottom: 20px;">
        <div class="user-info">
          <div id="fullName" class="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        <div class="stats-block">
          <div class="stats-item tickets-item">
              <span id="ticketStats" class="stats-text">0</span>
              <div class="stats-icon stats-icon-star"><i class="fa-solid fa-ticket"></i></div>
              <i class="fa-solid fa-circle-question info-question-icon" id="info-question-icon"></i>
          </div>
        </div>
    </div>

    <h2 class="page-title" style="grid-column: 1 / -1; margin-bottom: 5px;">
        üéØ –¶–µ–Ω—Ç—Ä –∑–∞–¥–∞–Ω–∏–π
    </h2>
    <span class="manual-hint" style="display: block; font-size: 11px; color: #b0b0b0; text-align: center; margin-bottom: 15px; grid-column: 1 / -1;">
        –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Å–ø–∏—Å–∫—É –∑–∞–¥–∞–Ω–∏–π.
    </span>

    <div class="complex-switch-wrapper" style="grid-column: 1 / -1; margin-bottom: 20px;">
        
        <input type="radio" name="view" id="view-twitch" value="twitch" checked>
        <input type="radio" name="view" id="view-telegram" value="telegram">
        <input type="radio" name="view" id="view-manual" value="manual">

        <div class="switch-row switch-row-top">
            <label for="view-twitch" class="switch-label">
                <i class="fa-brands fa-twitch"></i> Twitch
            </label>
            <label for="view-telegram" class="switch-label">
                <i class="fa-brands fa-telegram"></i> Telegram
            </label>
            <div class="slider-bg slider-top"></div>
        </div>

        <div class="switch-row switch-row-bottom">
            <label for="view-manual" class="switch-label">
                <i class="fa-solid fa-list-check"></i> –ó–∞–¥–∞–Ω–∏—è —Å —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
            </label>
            <div class="slider-bg slider-bottom"></div>
        </div>

    </div>
    
    <div id="section-auto-quests" style="grid-column: 1 / -1; width: 100%;">
        <div id="challenge-container" style="width: 100%; margin-bottom: 0;"></div>
        
       <div id="telegram-static-quests" class="hidden" style="width: 100%; margin-top: 5px;">
        
        <div class="quest-card challenge-card" style="padding: 12px; gap: 0; min-height: auto;">
            
            <div id="tg-tasks-list" style="display: flex; flex-direction: column; gap: 4px; width: 100%;">
                
                <div id="tg-row-sub" class="tg-row" style="display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.03); padding: 5px 8px; border-radius: 8px; min-height: 36px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 22px; height: 22px; background: #0088CC; border-radius: 5px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 8px rgba(255,255,255,0.15);">
                            <i class="fa-solid fa-user-plus" style="color: #fff; font-size: 10px;"></i>
                        </div>
                        <span style="font-size: 11px; font-weight: 500;">–ü–æ–¥–ø–∏—Å–∫–∞</span>
                    </div>
                    <button id="btn-tg-sub" data-reward="+5 üéü" onclick="updateTelegramStatus()" style="background: #0088CC; border: none; border-radius: 4px; color: #fff; padding: 4px 8px; font-size: 10px; font-weight: 700; cursor: pointer; min-width: 45px;">+5 üéü</button>
                </div>

                <div id="tg-row-vote" class="tg-row" style="display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.03); padding: 5px 8px; border-radius: 8px; min-height: 36px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 22px; height: 22px; background: #0088CC; border-radius: 5px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 8px rgba(255,255,255,0.15);">
                            <i class="fa-solid fa-square-poll-vertical" style="color: #fff; font-size: 10px;"></i>
                        </div>
                        <div style="display: flex; flex-direction: column; justify-content: center;">
                            <span style="font-size: 11px; font-weight: 500; line-height: 1.1;">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</span>
                            <span style="font-size: 9px; color: #888; line-height: 1;">–∫–∞–∂–¥—ã–µ 30 –¥–Ω–µ–π</span>
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 2px;">
                        <button id="btn-tg-vote" data-reward="+10 üéü" onclick="doTelegramVote()" style="background: #0088CC; border: none; border-radius: 4px; color: #fff; padding: 4px 8px; font-size: 10px; font-weight: 700; cursor: pointer; min-width: 45px;">+10 üéü</button>
                        <span id="tg-vote-timer" class="hidden" style="font-size: 8px; color: #666;">—Ç–∞–π–º–µ—Ä...</span>
                    </div>
                </div>

                <div id="tg-row-surname" class="tg-row" style="display: flex; flex-direction: column; background: rgba(255,255,255,0.03); padding: 5px 8px; border-radius: 8px; gap: 4px; min-height: 36px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 22px; height: 22px; background: #0088CC; border-radius: 5px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 8px rgba(255,255,255,0.15);">
                                <i class="fa-solid fa-signature" style="color: #fff; font-size: 10px;"></i>
                            </div>
                            <div style="display: flex; flex-direction: column; justify-content: center;">
                                <span style="font-size: 11px; font-weight: 500; line-height: 1.1;">–ò–º—è –±–æ—Ç–∞ –≤ –Ω–∏–∫–µ</span>
                                <span style="font-size: 9px; color: #888;">–ú–æ–∂–Ω–æ –∑–∞–±–∏—Ä–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–∏ 7 –¥–Ω–µ–π –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.</span>
                            </div>
                        </div>
                        <button id="btn-tg-surname" data-reward="+15 üéü" onclick="checkTelegramProfile()" style="background: #0088CC; border: none; border-radius: 4px; color: #fff; padding: 4px 8px; font-size: 10px; font-weight: 700; cursor: pointer; min-width: 45px;">+15 üéü</button>
                    </div>
                    <div style="width: 100%; height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; display: flex;">
                         <div id="tg-surname-fill" style="width: 0%; height: 100%; background: #0088CC;"></div>
                    </div>
                </div>

                <div id="tg-row-bio" class="tg-row" style="display: flex; flex-direction: column; background: rgba(255,255,255,0.03); padding: 5px 8px; border-radius: 8px; gap: 4px; min-height: 36px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 22px; height: 22px; background: #0088CC; border-radius: 5px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 8px rgba(255,255,255,0.15);">
                                <i class="fa-solid fa-link" style="color: #fff; font-size: 10px;"></i>
                            </div>
                            <div style="display: flex; flex-direction: column; justify-content: center;">
                                <span style="font-size: 11px; font-weight: 500; line-height: 1.1;">–†–µ—Ñ. —Å—Å—ã–ª–∫–∞ –≤ –±–∏–æ</span>
                                <span style="font-size: 9px; color: #888;">–ú–æ–∂–Ω–æ –∑–∞–±–∏—Ä–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–∏ 7 –¥–Ω–µ–π –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.</span>
                            </div>
                        </div>
                        <button id="btn-tg-bio" data-reward="+20 üéü" onclick="checkTelegramProfile()" style="background: #0088CC; border: none; border-radius: 4px; color: #fff; padding: 4px 8px; font-size: 10px; font-weight: 700; cursor: pointer; min-width: 45px;">+20 üéü</button>
                    </div>
                    <div style="width: 100%; height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; display: flex;">
                         <div id="tg-bio-fill" style="width: 0%; height: 100%; background: #0088CC;"></div>
                    </div>
                </div>

                <div id="tg-row-reaction" class="tg-row" style="display: flex; flex-direction: column; background: rgba(255,255,255,0.03); padding: 5px 8px; border-radius: 8px; gap: 4px; min-height: 36px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 22px; height: 22px; background: #0088CC; border-radius: 5px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 8px rgba(255,255,255,0.15);">
                                <i class="fa-regular fa-face-smile" style="color: #fff; font-size: 10px;"></i>
                            </div>
                            <span style="font-size: 11px; font-weight: 500;">–†–µ–∞–∫—Ü–∏–∏</span>
                        </div>
                        <span style="font-size: 10px; color: #fff; font-weight: 700; opacity: 0.9;">+1 üéü /—à—Ç</span>
                    </div>
                    <div style="width: 100%; height: 3px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; display: flex;">
                         <div id="tg-reaction-fill" style="width: 0%; height: 100%; background: #0088CC;"></div>
                    </div>
                    <div style="text-align: right; font-size: 9px; color: #666; font-family: monospace;">
                        <span id="tg-reaction-count">0</span>/7
                    </div>
                </div>
                
                <div id="tg-all-done-msg" class="hidden" style="text-align: center; padding: 20px; color: #666; font-size: 12px;">
                    –í—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! üéâ
                </div>

            </div>
        </div>
    </div>

        <hr style="border-color: rgba(255,255,255,0.1); margin: 20px 0; width: 100%;">
        
        <button id="quest-choose-btn" class="quest-choose-btn-roulette" style="width: 100%; margin: 0;">
            –ù–ê–ß–ê–¢–¨ –ò–°–ü–´–¢–ê–ù–ò–ï
        </button>
        <div id="quest-choose-container" class="quest-choose-container hidden" style="width: 100%; margin-top: 10px;"></div>
        <div id="active-automatic-quest-container" style="width: 100%; margin-top: 5px;"></div>
    </div>

    <div id="section-manual-quests" class="hidden" style="grid-column: 1 / -1; width: 100%;">
        <div style="text-align: center; margin-bottom: 15px; color: #ffcc00; font-size: 13px; font-weight: 600;">
             üìù –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
        </div>
        <div id="manual-quests-list" style="width: 100%;">
            <div class="spinner"></div>
        </div>
        <span class="manual-hint" style="display: block; font-size: 11px; color: #666; text-align: center; margin-top: 15px; margin-bottom: 20px;">
            –°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –≤ <span style="color: #ffc700;">–ü—Ä–æ—Ñ–∏–ª–µ</span>
        </span>
    </div>

  </main>
  
  <footer class="app-footer">
    <a href="/leaderboard" id="nav-leaderboard" class="footer-item"><div class="icon-wrapper"><i class="fa-solid fa-trophy"></i></div><span>–õ–∏–¥–µ—Ä–±–æ—Ä–¥</span></a>
    <a href="#" id="nav-quests" class="footer-item active"><div class="icon-wrapper"><i class="fa-solid fa-check-double"></i></div><span>–ó–∞–¥–∞–Ω–∏—è</span></a>
    <a href="/menu" id="nav-dashboard" class="footer-item"><div class="icon-wrapper"><i class="fa-solid fa-house"></i></div><span>–ì–ª–∞–≤–Ω–∞—è</span></a>
    <a href="/events" class="footer-item"><div class="icon-wrapper"><i class="fa-solid fa-fire"></i></div><span>–ì—Ä–∏–Ω–¥</span></a>
    <a href="/auction" class="footer-item">
        <div class="icon-wrapper"><i class="fa-solid fa-gavel"></i></div>
        <span>–ê—É–∫—Ü–∏–æ–Ω</span>
    </a>
  </footer>

  <div id="promocode-overlay" class="promocode-overlay hidden"></div>

  <div id="reward-claimed-overlay" class="prompt-overlay hidden">
    <div class="prompt-modal">
        <h3>–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!</h3>
        <p style="font-size: 14px; line-height: 1.5; color: var(--text-color-muted);">
            –ü—Ä–æ–º–æ–∫–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –≤—Å–µ —Å–≤–æ–∏ –Ω–∞–≥—Ä–∞–¥—ã —Ç–∞–º.
        </p>
        <div class="prompt-actions">
            <button id="reward-close-btn" class="cancel-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
            <a href="/profile" class="confirm-btn">–ü—Ä–æ—Ñ–∏–ª—å</a>
        </div>
    </div>
  </div>

  <div id="tickets-claimed-overlay" class="prompt-overlay hidden">
    <div class="prompt-modal">
        <h3>–ë–∏–ª–µ—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã!</h3>
        <p style="font-size: 14px; line-height: 1.5; color: var(--text-color-muted);">
            –ë–∏–ª–µ—Ç—ã –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –Ω–∞—á–∏—Å–ª–µ–Ω—ã –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å.
        </p>
        <div class="prompt-actions">
            <button id="tickets-claim-close-btn" class="confirm-btn">–û—Ç–ª–∏—á–Ω–æ!</button>
        </div>
    </div>
  </div>

  <div id="info-modal-overlay" class="prompt-overlay hidden">
    <div class="prompt-modal">
        <h3>–ß—Ç–æ —Ç–∞–∫–æ–µ –±–∏–ª–µ—Ç—ã?</h3>
        <p style="font-size: 14px; line-height: 1.5; color: var(--text-color-muted);">
            –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∏ —á–µ–ª–ª–µ–Ω–¥–∂–∏, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –±–∏–ª–µ—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–∞—Ö —Ü–µ–Ω–Ω—ã—Ö –ø—Ä–∏–∑–æ–≤!
        </p>
        <div class="prompt-actions">
            <button class="confirm-btn" id="info-modal-close-btn">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>
  </div>

  <div id="schedule-modal-overlay" class="prompt-overlay hidden">
    <div class="prompt-modal" style="width: 90%; max-width: 400px; padding: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0; font-size: 18px;">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∏–º–æ–≤</h3>
            <button id="schedule-modal-close-btn" class="promo-notification-close" style="background: rgba(255,255,255,0.1); width: 30px; height: 30px;">&times;</button>
        </div>
        <img src="https://i.postimg.cc/NMw2ByPZ/raspisanie-strimov.jpg" alt="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" style="width: 100%; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
        <button onclick="Telegram.WebApp.openLink('https://www.twitch.tv/hatelove_ttv')" class="confirm-btn" style="width: 100%; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; background-color: #9146ff; color: white; border: none; cursor: pointer; font-size: 14px; font-weight: 600; padding: 12px;">
            <i class="fa-brands fa-twitch"></i> –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∫–∞–Ω–∞–ª
        </button>
    </div>
</div>

  <div id="custom-prompt-overlay" class="prompt-overlay hidden">
    <div class="prompt-modal">
        <h3 id="prompt-title">Title</h3>
        <p>–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>
        <input type="text" id="prompt-input" placeholder="–í–∞—à –Ω–∏–∫ –∏–ª–∏ —Å—Å—ã–ª–∫–∞...">
        <div class="prompt-actions">
            <button id="prompt-cancel" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
            <button id="prompt-confirm" class="confirm-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>
  </div>

  <script src="/public/quests.js"></script>
</body>
</html>
