<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –†—É–ª–µ—Ç–∫–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #1a1a1a; color: #e0e0e0; font-family: monospace; }
        #log { border: 1px solid #444; padding: 10px; height: 90vh; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>–û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –¥–ª—è —Ä—É–ª–µ—Ç–∫–∏...</h1>
    <pre id="log"></pre>

    <script>
        // –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
        const SUPABASE_URL = 'https://pyeuckjcrsiaseyqrsek.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5ZXVja2pjcnNpYXNleXFyc2VrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0NzEyOTgsImV4cCI6MjA3MDA0NzI5OH0.srRwuUygiF7jr3-b2AwyRNAmrChlW3Bzp3I-9Ju2TVg';

        const logElement = document.getElementById('log');

        function logMessage(message) {
            console.log(message);
            const content = typeof message === 'object' ? JSON.stringify(message, null, 2) : message;
            logElement.textContent = `${new Date().toLocaleTimeString()}: ${content}\n\n${logElement.textContent}`;
        }

        // --- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase ---
        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–î–ï–°–¨: —Å–æ–∑–¥–∞—ë–º –∫–ª–∏–µ–Ω—Ç —Å –Ω–æ–≤—ã–º –∏–º–µ–Ω–µ–º
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        logMessage('–ö–ª–∏–µ–Ω—Ç Supabase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.');

        // ‚úÖ –ò –ò–°–ü–û–õ–¨–ó–£–ï–ú –ù–û–í–û–ï –ò–ú–Ø –ó–î–ï–°–¨
        const channel = supabaseClient.channel('roulette-triggers-channel')
            .on(
                'postgres_changes',
                {
                    event: 'INSERT',
                    schema: 'public',
                    table: 'roulette_triggers'
                },
                (payload) => {
                    logMessage('üéâ –ü–û–õ–£–ß–ï–ù –ù–û–í–´–ô –°–ò–ì–ù–ê–õ –î–õ–Ø –†–£–õ–ï–¢–ö–ò! üéâ');
                    logMessage(payload);

                    // –ó–¥–µ—Å—å –≤—ã –¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å –≤–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                }
            )
            .subscribe((status, err) => {
                if (status === 'SUBSCRIBED') {
                    logMessage('‚úÖ –£—Å–ø–µ—à–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É roulette_triggers!');
                } else {
                    logMessage(`–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: ${status}`);
                    if(err) logMessage(err);
                }
            });

        logMessage('–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª...');

    </script>
</body>
</html>
