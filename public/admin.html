<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Админ-панель</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link rel="stylesheet" href="admin.css">
</head>
<body>

    <button id="sleep-mode-toggle" class="sleep-mode-toggle hidden" title="Режим сна">
        <i class="fa-solid fa-power-off"></i>
    </button>

    <div id="loader-overlay" class="loader-overlay hidden">
        <div class="spinner"></div>
    </div>

    <main id="app-container" class="main-content">
        <div id="view-admin-main" class="view">
            <div class="page-header">
                <a href="/menu" class="back-button"><i class="fa-solid fa-house"></i> Назад</a>
                <h1 class="page-header-title">Админка</h1>
                <div style="width: 80px;"></div>
            </div>

            <div class="tabs-container main-tabs">
                <button class="tab-button active" data-tab="main">Основное</button>
                <button class="tab-button" data-tab="admin">Администрирование</button>
            </div>

            <div id="tab-content-main" class="tab-content active">
                <div class="admin-icon-menu">
                    <div class="admin-icon-button" data-view="view-admin-pending-actions">
                        <div class="icon-wrapper">
                            <i class="fa-solid fa-user-check"></i>
                            <span class="notification-badge hidden" id="main-pending-count">0</span>
                        </div>
                        <span>Выдача и проверки</span>
                    </div>
                    <div class="admin-icon-button" data-view="view-admin-twitch-rewards">
                        <div class="icon-wrapper" style="color: var(--twitch-color);"><i class="fa-brands fa-twitch"></i></div>
                        <span>Twitch награды</span>
                    </div>
                    <div class="admin-icon-button" data-view="view-admin-promocodes">
                        <div class="icon-wrapper"><i class="fa-solid fa-ticket"></i></div>
                        <span>Промокоды</span>
                    </div>
                </div> </div> <div id="tab-content-admin" class="tab-content hidden">
                <div class="admin-icon-menu">
                    <div class="admin-icon-button" data-view="view-admin-quests">
                        <div class="icon-wrapper"><i class="fa-solid fa-list-check"></i></div>
                        <span>Задания</span>
                    </div>
                    <div class="admin-icon-button" data-view="view-admin-challenges">
                        <div class="icon-wrapper"><i class="fa-solid fa-trophy"></i></div>
                        <span>Челленджи</span>
                    </div>
                    <div class="admin-icon-button" data-view="view-admin-categories">
                        <div class="icon-wrapper"><i class="fa-solid fa-folder-tree"></i></div>
                        <span>Категории</span>
                    </div>
                    <div class="admin-icon-button" data-view="view-admin-settings">
                        <div class="icon-wrapper"><i class="fa-solid fa-sliders"></i></div>
                        <span>Настройки</span>
                    </div>
                    <div class="admin-icon-button" data-view="view-admin-roulette">
                        <div class="icon-wrapper" style="color: var(--warning-color);"><i class="fa-solid fa-dice"></i></div>
                        <span>Рулетки</span>
                    </div>
                     <div class="admin-icon-button" data-view="view-admin-statistics">
                        <div class="icon-wrapper" style="color: var(--primary-color);"><i class="fa-solid fa-chart-line"></i></div>
                        <span>Статистика</span>
                    </div>
                    <a href="/roulette.html" target="_blank" class="admin-icon-button">
                        <div class="icon-wrapper"><i class="fa-solid fa-eye"></i></div>
                        <span>Просмотр рулетки</span>
                    </a>
                    <div class="admin-icon-button" data-view="view-admin-user-management">
                        <div class="icon-wrapper"><i class="fa-solid fa-user-gear"></i></div>
                        <span>Пользователи</span>
                    </div>
                    <div class="admin-icon-button" data-view="view-admin-cauldron">
                        <div class="icon-wrapper" style="color: #ff9500;"><i class="fa-solid fa-hat-wizard"></i></div>
                        <span>Ивент "Котел"</span>
                    </div>
                </div> </div> <div class="quest-card" style="margin-top: 20px; text-align: center;">
                <p style="font-size: 14px; color: var(--text-color-muted); margin:0;">
                    Панель для администратирования канала HATElove.ttv.
                </p>
            </div>
        </div> 
      <div id="view-admin-user-management" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Управление</h1>
                <div style="width: 60px;"></div> </div>

<div class="quest-card">
            <div class="user-management-section">
                <h3><i class="fa-solid fa-gifts" style="color: var(--primary-color);"></i> Выдача наград</h3>
                <div class="admin-form">
                    <label>Выдать звезды Чекпоинта<div class="tooltip">?<span class="tooltip-text">Добавляет указанное количество звёзд Чекпоинта пользователю.</span></div></label>
                    <form id="grant-checkpoint-stars-form" class="hidden admin-sub-form">
                        <p>Для: <strong id="grant-cp-user-name">...</strong></p>
                        <input type="hidden" name="user_id_to_grant_cp">
                        <input type="number" name="amount_cp" required placeholder="Количество звезд">
                        <button type="submit">Подтвердить выдачу</button>
                    </form>
                    <button id="open-grant-cp-search" class="admin-menu-button">
                        <i class="fa-solid fa-search"></i> Найти пользователя
                    </button>
                </div>
                <div class="admin-form" style="margin-top: 20px;">
                    <label>Выдать билеты<div class="tooltip">?<span class="tooltip-text">Добавляет билеты для участия в розыгрышах.</span></div></label>
                    <form id="grant-tickets-form" class="hidden admin-sub-form">
                        <p>Для: <strong id="grant-tickets-user-name">...</strong></p>
                        <input type="hidden" name="user_id_to_grant_tickets">
                        <input type="number" name="amount_tickets" required placeholder="Количество билетов">
                        <button type="submit">Подтвердить выдачу</button>
                    </form>
                    <button id="open-grant-tickets-search" class="admin-menu-button">
                        <i class="fa-solid fa-search"></i> Найти пользователя
                    </button>
                </div>
                <div class="admin-form" style="margin-top: 20px;">
                    <label>Выдать промокод<div class="tooltip">?<span class="tooltip-text">Находит свободный промокод указанного номинала и отправляет пользователю в ЛС.</span></div></label>
                    <button id="open-issue-promocode-search" class="admin-menu-button">
                        <i class="fa-solid fa-search"></i> Найти пользователя
                    </button>
                </div>
            </div>
        </div>

        <div class="quest-card" style="margin-top: 20px;">
            <div class="user-management-section">
                <h3><i class="fa-solid fa-clipboard-list" style="color: var(--action-color);"></i> Журнал выдачи (7 дней)</h3>
                <div id="admin-grant-log-list" style="max-height: 300px; overflow-y: auto; padding-top: 10px; display: flex; flex-direction: column; gap: 8px;">
                    <p style="text-align: center; color: var(--text-color-muted);">Загрузка журнала...</p>
                </div>
            </div>
        </div>

            <div class="quest-card" style="margin-top: 20px;">
                <div class="user-management-section">
                    <h3><i class="fa-solid fa-snowflake" style="color: #5ac8fa;"></i> Заморозка / Разморозка</h3>
                     <div class="admin-form">
                        <label>Звезды Чекпоинта<div class="tooltip">?<span class="tooltip-text">Временно запрещает пользователю тратить звёзды Чекпоинта. 0 дней = разморозка.</span></div></label>
                        <form id="freeze-checkpoint-stars-form" class="hidden admin-sub-form">
                            <p>Для: <strong id="freeze-cp-user-name">...</strong></p>
                            <input type="hidden" name="user_id_to_freeze_cp">
                            <input type="number" name="days_cp" required placeholder="Кол-во дней (0 для разморозки)">
                            <button type="submit">Применить</button>
                        </form>
                        <button id="open-freeze-cp-search" class="admin-menu-button">
                            <i class="fa-solid fa-search"></i> Найти пользователя
                        </button>
                    </div>
                    <div class="admin-form" style="margin-top: 20px;">
                        <label>Билеты<div class="tooltip">?<span class="tooltip-text">Временно запрещает пользователю участвовать в розыгрышах. 0 дней = разморозка.</span></div></label>
                        <form id="freeze-tickets-form" class="hidden admin-sub-form">
                            <p>Для: <strong id="freeze-tickets-user-name">...</strong></p>
                            <input type="hidden" name="user_id_to_freeze_tickets">
                            <input type="number" name="days_tickets" required placeholder="Кол-во дней (0 для разморозки)">
                            <button type="submit">Применить</button>
                        </form>
                        <button id="open-freeze-tickets-search" class="admin-menu-button">
                            <i class="fa-solid fa-search"></i> Найти пользователя
                        </button>
                    </div>
                </div>
            </div>

            <div class="quest-card" style="margin-top: 20px;">
                <div class="user-management-section">
                    <h3><i class="fa-solid fa-bolt" style="color: var(--warning-color);"></i> Принудительное выполнение</h3>
                    <div class="admin-form">
                        <label>Выполнить квест/челлендж<div class="tooltip">?<span class="tooltip-text">Обходит все проверки и помечает квест или челлендж как выполненный для пользователя. Он сможет забрать награду.</span></div></label>
                         <button id="open-force-complete-search" class="admin-menu-button">
                             <i class="fa-solid fa-search"></i> Найти пользователя
                         </button>
                         </div>
                </div>
            </div>

            <div class="quest-card" style="margin-top: 20px;">
                 <div class="user-management-section">
                    <h3 style="color: var(--danger-color);"><i class="fa-solid fa-broom"></i> Очистка прогресса (Чекпоинт)</h3>
                    <div class="admin-form">
                        <label>Сбросить награды Чекпоинта<div class="tooltip">?<span class="tooltip-text">Удаляет все полученные награды Чекпоинта у пользователя, но НЕ ТРОГАЕТ баланс звёзд. Действие необратимо.</span></div></label>
                        <form id="reset-checkpoint-progress-form" class="hidden admin-sub-form">
                             <p>Для: <strong id="reset-cp-progress-user-name">...</strong></p>
                             <input type="hidden" name="user_id_to_reset">
                             <button type="submit" class="admin-action-btn reject" style="width: 100%;">Подтвердить сброс наград</button>
                        </form>
                        <button id="open-reset-cp-progress-search" class="admin-menu-button">
                             <i class="fa-solid fa-search"></i> Найти пользователя
                        </button>
                    </div>
                    <div class="admin-form" style="margin-top: 20px;">
                        <label>Обнулить звёзды Чекпоинта<div class="tooltip">?<span class="tooltip-text">Устанавливает баланс звёзд Чекпоинта на 0, но НЕ ТРОГАЕТ список наград. Действие необратимо.</span></div></label>
                        <form id="clear-checkpoint-stars-form" class="hidden admin-sub-form">
                             <p>Для: <strong id="clear-cp-stars-user-name">...</strong></p>
                             <input type="hidden" name="user_id_to_clear">
                             <button type="submit" class="admin-action-btn reject" style="width: 100%;">Подтвердить обнуление звёзд</button>
                        </form>
                         <button id="open-clear-cp-stars-search" class="admin-menu-button">
                             <i class="fa-solid fa-search"></i> Найти пользователя
                         </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-admin-pending-actions" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Ожидают действия</h1>
                
                <button id="reload-pending-actions-btn" class="back-button" style="width: 60px; font-size: 18px; text-align: right; padding-right: 5px;">
                    <i class="fa-solid fa-rotate-right"></i>
                </button>
            </div>
            <div class="tabs-container">
                <button class="tab-button active" data-tab="submissions"><i class="fa-solid fa-user-check"></i> Проверки</button>
                <button class="tab-button" data-tab="event-prizes"><i class="fa-solid fa-trophy"></i> Розыгрыши</button>
                <button class="tab-button" data-tab="checkpoint-prizes"><i class="fa-solid fa-flag-checkered"></i> Чекпоинт</button>
            </div>
            <div id="tab-content-submissions" class="tab-content active">
                <div class="pending-actions-grid">
                    </div>
            </div>
            <div id="tab-content-event-prizes" class="tab-content hidden">
                 <div class="pending-actions-grid">
                    </div>
            </div>
            <div id="tab-content-checkpoint-prizes" class="tab-content hidden">
                 <div class="pending-actions-grid">
                    </div>
            </div>
        </div>

        <div id="view-admin-settings" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Настройки</h1>
                <div style="width: 60px;"></div>
            </div>
            <div class="quest-card">
                <div class="settings-group">
                    <h3>Внешний вид</h3>
                    <div class="admin-form" style="gap: 20px;">
                        <div>
                            <label for="setting-menu-banner-url">URL баннера "Гонка за скинами"</label>
                            <input type="text" id="setting-menu-banner-url" placeholder="https://example.com/banner.png">
                        </div>
                        <div>
                            <label for="setting-checkpoint-banner-url">URL баннера "Марафон Чекпоинт"</label>
                            <input type="text" id="setting-checkpoint-banner-url" placeholder="https://example.com/banner2.png">
                        </div>
                    </div>
                </div>
            </div>
            <div class="quest-card" style="margin-top: 20px;">
                <div class="settings-group">
                    <h3>Порядок слайдов на главной</h3>
                    <div id="slider-order-manager">
                        <p style="font-size: 12px; color: var(--text-color-muted);">Загрузка...</p>
                    </div>
                </div>
            </div>
            <div class="quest-card" style="margin-top: 20px;">
                <div class="settings-group">
                    <h3>Системы</h3>
                    <div class="setting-item">
                        <span class="setting-label">Гонка за скинами</span>
                        <label class="toggle-switch"><input type="checkbox" id="setting-skin-race-enabled"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Система Заданий</span>
                        <label class="toggle-switch"><input type="checkbox" id="setting-quests-enabled"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Система Челленджей</span>
                        <label class="toggle-switch"><input type="checkbox" id="setting-challenges-enabled"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Система Чекпоинта</span>
                        <label class="toggle-switch"><input type="checkbox" id="setting-checkpoint-enabled"><span class="toggle-slider"></span></label>
                    </div>
                </div>
            </div>
            <div class="quest-card" style="margin-top: 20px;">
                <div class="settings-group">
                    <h3>Награды</h3>
                    <div class="setting-item">
                        <span class="setting-label">Награды за Задания</span>
                        <label class="toggle-switch"><input type="checkbox" id="setting-quest-rewards-enabled"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Награды за Челленджи</span>
                        <label class="toggle-switch"><input type="checkbox" id="setting-challenge-rewards-enabled"><span class="toggle-slider"></span></label>
                    </div>
                </div>
            </div>
             <div class="quest-card" style="margin-top: 20px;">
                <div class="settings-group">
                    <button id="save-settings-btn" class="admin-action-btn approve" style="width: 100%;">Сохранить все настройки</button>
                </div>
            </div>
             <div class="quest-card" style="margin-top: 20px;">
                <div class="settings-group">
                    <h3>Опасно</h3>
                    <div class="admin-form" style="gap: 10px;">
                        <button id="reset-all-quests-btn" class="admin-action-btn reject" style="width: 100%;">Сбросить квесты у всех</button>
                        <button id="reset-all-checkpoint-progress-btn" class="admin-action-btn reject" style="width: 100%;">Сбросить награды Чекпоинта у всех</button>
                        <button id="clear-all-checkpoint-stars-btn" class="admin-action-btn reject" style="width: 100%;">Обнулить звёзды Чекпоинта у всех</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-admin-categories" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Категории</h1>
                <div style="width: 60px;"></div>
            </div>
            <div class="quest-card">
                <form id="create-category-form" class="admin-form">
                    <label>Название новой категории</label>
                    <input type="text" name="name" required placeholder="Например, 'Сложные задания'">
                    <button type="submit">Создать категорию</button>
                </form>
            </div>
             <div id="categories-list" class="quests-container" style="margin-top: 20px;"></div>
        </div>

        <div id="view-admin-challenges" class="view hidden">
             <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Челленджи</h1>
                <button id="go-create-challenge" class="admin-menu-button" style="width: auto; padding: 8px 12px; font-size: 14px;">Создать</button>
            </div>
            <div id="challenges-list" class="quests-container"></div>
        </div>

        <div id="view-admin-challenge-form" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-challenges"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 id="challenge-form-title" class="page-header-title">Новый челлендж</h1>
                <div style="width: 60px;"></div>
            </div>
            <div class="quest-card">
                <form id="challenge-form" class="admin-form">
                    <input type="hidden" name="challenge_id">
                    <label>Описание</label>
                    <textarea name="description" rows="3" required></textarea>
                    <label>Тип условия</label>
                    <select name="condition_type" required>
                        <option value="telegram_messages">Сообщения в Telegram</option>
                        <option value="twitch_points">Ранг/PTS в Twitch</option>
                        <option value="twitch_messages">Сообщения Twitch</option>
                        <option value="twitch_uptime">Twitch (время просмотра)</option>
                    </select>
                    <div class="challenge-period-wrapper hidden">
                        <label>Период</label>
                        <select name="challenge_period">
                           <option value="session">Сессия</option>
                           <option value="week">Неделя</option>
                           <option value="month">Месяц</option>
                        </select>
                    </div>
                    <label>Целевое значение</label>
                    <input type="number" name="target_value" required>
                    <label>Награда (количество звёзд)</label>
                    <input type="number" name="reward_amount" required>
                    <label>Срок выполнения (в часах)</label>
                    <input type="number" name="duration_days" value="16" required>
                    <label>Статус</label>
                    <select name="is_active">
                        <option value="true">Активен</option>
                        <option value="false">Неактивен</option>
                    </select>
                    <button type="submit">Сохранить</button>
                </form>
            </div>
        </div>

        <div id="view-admin-quests" class="view hidden">
             <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Задания</h1>
                <button id="go-create-quest" class="admin-menu-button" style="width: auto; padding: 8px 12px; font-size: 14px;">Создать</button>
            </div>
            <div id="quests-list" class="quests-container"></div>
        </div>
                <button id="save-order-button" class="admin-action-btn approve hidden" style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 100; width: auto; padding: 10px 20px;">
            <i class="fa-solid fa-save"></i> Сохранить порядок</button>

        <div id="view-admin-promocodes" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Промокоды</h1>
                <div style="width: 60px;"></div>
            </div>
            <div class="quest-card">
                <form id="add-promocodes-form" class="admin-form">
                    <label>Список кодов (каждый с новой строки)</label>
                    <textarea name="codes" rows="6" required></textarea>
                    <label>Количество звёзд</label>
                    <input type="number" name="reward_value" required>
                    <label>Описание награды</label>
                    <input type="text" name="description" required>
                    <button type="submit">Добавить</button>
                </form>
            </div>
        </div>

        <div id="view-admin-create" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-quests"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Новое задание</h1>
                <div style="width: 60px;"></div>
            </div>
            <div class="quest-card">
                <form id="create-quest-form" class="admin-form">
                    <label>Название</label>
                    <input type="text" name="title" required>
                    <label>URL иконки (по желанию)</label>
                    <input type="text" name="icon_url">
                    <label>Описание</label>
                    <textarea name="description" rows="3"></textarea>
                    <label>Награда (количество звёзд)</label>
                    <input type="number" name="reward_amount" required>
                    <label>Тип квеста</label>
                    <select name="quest_type">
                        <option value="manual_check">Ручная проверка</option>
                        <option value="automatic_telegram_messages">Telegram (сообщения)</option>
                        <option value="automatic_twitch_points">Twitch (ранг/PTS)</option>
                        <option value="automatic_twitch_messages">Twitch (сообщения)</option>
                        <option value="automatic_twitch_uptime">Twitch (время просмотра)</option>
                    </select>
                    <div class="manual-options-wrapper">
                        <label>Категория (для ручных заданий)</label>
                        <select name="category_id"><option value="">Без категории</option></select>
                        <label>Режим выполнения (для ручных заданий)</label>
                        <select name="is_repeatable">
                            <option value="false">Одноразовое</option>
                            <option value="true">Многоразовое</option>
                        </select>
                        <label>URL для перехода (для ручных заданий)</label>
                        <input type="text" name="action_url" placeholder="https://tiktok.com/...">
                    </div>
                    <div class="automatic-options-wrapper hidden">
                        <div class="twitch-period-wrapper hidden">
                            <label>Период</label>
                            <select name="twitch_period">
                               <option value="session">Сессия</option>
                               <option value="week">Неделя</option>
                               <option value="month">Месяц</option>
                            </select>
                        </div>
                        <label>Цель (для авто-квестов)</label>
                        <input type="number" name="target_value">
                    </div>
                    <label>Срок выполнения (в часах, 0 - бессрочно)</label>
                    <input type="number" name="duration_hours" value="0">
                    <label>Статус</label>
                    <select name="is_active">
                        <option value="true">Активен</option>
                        <option value="false">Неактивен</option>
                    </select>
                    <button type="submit">Создать</button>
                </form>
            </div>
        </div>

        <div id="view-admin-edit" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-quests"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Редактирование</h1>
                <div style="width: 60px;"></div>
            </div>
            <div class="quest-card">
                <form id="edit-quest-form" class="admin-form">
                    <input type="hidden" name="quest_id">
                    <label>Название</label>
                    <input type="text" name="title" required>
                    <label>URL иконки (по желанию)</label>
                    <input type="text" name="icon_url">
                    <label>Описание</label>
                    <textarea name="description" rows="3"></textarea>
                    <label>Награда (количество звёзд)</label>
                    <input type="number" name="reward_amount" required>
                    <label>Тип квеста</label>
                    <select name="quest_type">
                        <option value="manual_check">Ручная проверка</option>
                        <option value="automatic_telegram_messages">Telegram (сообщения)</option>
                        <option value="automatic_twitch_points">Twitch (ранг/PTS)</option>
                        <option value="automatic_twitch_messages">Twitch (сообщения)</option>
                        <option value="automatic_twitch_uptime">Twitch (время просмотра)</option>
                    </select>
                    <div class="manual-options-wrapper">
                        <label>Категория (для ручных заданий)</label>
                        <select name="category_id"><option value="">Без категории</option></select>
                        <label>Режим выполнения (для ручных заданий)</label>
                        <select name="is_repeatable">
                            <option value="false">Одноразовое</option>
                            <option value="true">Многоразовое</option>
                        </select>
                        <label>URL для перехода (для ручных заданий)</label>
                        <input type="text" name="action_url" placeholder="https://tiktok.com/...">
                    </div>
                     <div class="automatic-options-wrapper hidden">
                        <div class="twitch-period-wrapper hidden">
                            <label>Период</label>
                            <select name="twitch_period">
                               <option value="session">Сессия</option>
                               <option value="week">Неделя</option>
                               <option value="month">Месяц</option>
                            </select>
                        </div>
                        <label>Цель (для авто-квестов)</label>
                        <input type="number" name="target_value">
                    </div>
                    <label>Срок выполнения (в часах, 0 - бессрочно)</label>
                    <input type="number" name="duration_hours" value="0">
                    <label>Статус</label>
                    <select name="is_active">
                        <option value="true">Активен</option>
                        <option value="false">Неактивен</option>
                    </select>
                    <button type="submit">Сохранить</button>
                </form>
            </div>
        </div>

        <div id="view-admin-statistics" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Статистика</h1>
                <div style="width: 60px;"></div>
            </div>
            <div id="statistics-content">
                <h2 style="font-size: 20px; margin-bottom: 15px;">Склад Рулеток 📦</h2>
                 <div class="stats-grid">
                    <div class="stat-card">
                         <div class="stat-card-header">
                            <h4>Всего скинов в наличии</h4>
                            <div class="tooltip">?<span class="tooltip-text">Общее количество всех скинов, доступных для выпадения во всех рулетках.</span></div>
                        </div>
                        <p id="stat-total-stock">0</p>
                    </div>
                     <div class="stat-card">
                         <div class="stat-card-header">
                            <h4>Примерная стоимость</h4>
                            <div class="tooltip">?<span class="tooltip-text">Скоро... Ориентировочная суммарная стоимость всех скинов на складе.</span></div>
                        </div>
                        <p>Скоро...</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-admin-twitch-rewards" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Twitch награды</h1>
                <button id="reload-twitch-rewards-btn" class="back-button" style="width: 60px; font-size: 18px; text-align: right; padding-right: 5px;">
                    <i class="fa-solid fa-rotate-right"></i>
                </button>
                </div>
            <div id="twitch-rewards-container" class="pending-actions-grid" style="padding: 10px 0;">
                </div>
        </div>

        <div id="view-admin-roulette" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Призы для рулеток</h1>
                <div style="width: 60px;"></div>
            </div>
            <div class="quest-card">
                <form id="create-roulette-prize-form" class="admin-form">
                    <label>Название Twitch награды (триггер)</label>
                    <input type="text" name="reward_title" required placeholder="Например: Крутить рулетку">
                    <label>Название скина</label>
                    <input type="text" name="skin_name" required placeholder="Например: AWP | Asiimov">
                    <label>URL картинки скина</label>
                    <input type="text" name="image_url" required placeholder="https:// ... .png">
                    <label>Вес шанса<div class="tooltip">?<span class="tooltip-text">Чем выше число, тем выше шанс. Если у одного скина вес 90, а у другого 10, то их шансы будут 90% и 10%.</span></div></label>
                    <input type="number" name="chance_weight" required value="10">
                    <label>Количество в наличии</label>
                    <input type="number" name="quantity" required value="0" min="0">
                    <button type="submit">Добавить приз</button>
                </form>
            </div>
            <div id="roulette-prizes-list" class="quests-container" style="margin-top: 20px;"></div>
        </div>

        <div id="view-admin-cauldron" class="view hidden">
            <div class="page-header">
                <button class="back-button" data-view="view-admin-main"><i class="fa-solid fa-arrow-left"></i> Назад</button>
                <h1 class="page-header-title">Ивент "Котел"</h1>
                <div style="width: 60px;"></div>
            </div>

            <div class="tabs-container" id="cauldron-tabs">
                <button class="tab-button active" data-tab="cauldron-settings">Настройки</button>
                <button class="tab-button" data-tab="cauldron-rewards-1">Награды Ур. 1</button>
                <button class="tab-button" data-tab="cauldron-rewards-2">Награды Ур. 2</button>
                <button class="tab-button" data-tab="cauldron-rewards-3">Награды Ур. 3</button>
                <button class="tab-button" data-tab="cauldron-rewards-4">Награды Ур. 4</button>
                <button class="tab-button" data-tab="cauldron-distribution">Участники</button>
            </div>

            <form id="cauldron-settings-form">
                <div id="tab-content-cauldron-settings" class="tab-content active">
                    <div class="quest-card">
                        <div class="admin-form">
                            <div class="setting-item" style="padding: 0; border: none;">
                                <span class="setting-label">Ивент активен (виден пользователям)</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" name="is_visible_to_users">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <label>Название ивента</label>
                            <input type="text" name="title" required placeholder="Ведьминский котел">

                            <label>Цель Уровня 1</label>
                            <input type="number" name="goal_level_1" required placeholder="Например: 1000">

                            <label>Цель Уровня 2</label>
                            <input type="number" name="goal_level_2" required placeholder="Например: 3000">

                            <label>Цель Уровня 3</label>
                            <input type="number" name="goal_level_3" required placeholder="Например: 5000">

                            <label>Цель Уровня 4 (финал)</label>
                            <input type="number" name="goal_level_4" required placeholder="Например: 10000">

                            <label>URL баннера для главной</label>
                            <input type="text" name="banner_image_url" placeholder="https://....png">

                            <label>URL картинки Котла (Уровень 1)</label>
                            <input type="text" name="cauldron_image_url_1" placeholder="https://....png">

                            <label>URL картинки Котла (Уровень 2)</label>
                            <input type="text" name="cauldron_image_url_2" placeholder="https://....png">

                            <label>URL картинки Котла (Уровень 3)</label>
                            <input type="text" name="cauldron_image_url_3" placeholder="https://....png">

                            <label>URL картинки Котла (Уровень 4)</label>
                            <input type="text" name="cauldron_image_url_4" placeholder="https://....png">
                        </div>
                    </div>
                     <div class="quest-card" style="margin-top: 20px;">
                        <h3 style="margin-top: 0;">Опасная зона</h3>
                        <button id="reset-cauldron-btn" type="button" class="admin-action-btn reject" style="width: 100%;">Сбросить весь прогресс</button>
                    </div>
                </div>

                <div id="tab-content-cauldron-rewards-1" class="tab-content hidden">
                    <div class="quest-card">
                        <h3 style="margin-top:0;">Награды для Топ-20 (Уровень 1)</h3>
                        <div id="top-rewards-container-1"></div>
                        <button type="button" id="add-top-reward-btn-1" data-level="1" class="admin-action-btn" style="background-color: var(--action-color); width: 100%; margin-top: 15px;">
                            <i class="fa-solid fa-plus"></i> Добавить награду за место
                        </button>
                    </div>
                    <div class="quest-card" style="margin-top: 15px;">
                        <h3 style="margin-top:0;">Награда для остальных (Уровень 1)</h3>
                        <div class="admin-form">
                            <label>Название предмета</label>
                            <input type="text" name="default_reward_name_1" placeholder="Glock-18 | Fade">
                            <label>URL изображения</label>
                            <input type="text" name="default_reward_image_url_1" placeholder="https://....png">
                        </div>
                    </div>
                </div>

                <div id="tab-content-cauldron-rewards-2" class="tab-content hidden">
                    <div class="quest-card">
                        <h3 style="margin-top:0;">Награды для Топ-20 (Уровень 2)</h3>
                        <div id="top-rewards-container-2"></div>
                        <button type="button" id="add-top-reward-btn-2" data-level="2" class="admin-action-btn" style="background-color: var(--action-color); width: 100%; margin-top: 15px;">
                            <i class="fa-solid fa-plus"></i> Добавить награду за место
                        </button>
                    </div>
                    <div class="quest-card" style="margin-top: 15px;">
                        <h3 style="margin-top:0;">Награда для остальных (Уровень 2)</h3>
                        <div class="admin-form">
                            <label>Название предмета</label>
                            <input type="text" name="default_reward_name_2" placeholder="AK-47 | Redline">
                            <label>URL изображения</label>
                            <input type="text" name="default_reward_image_url_2" placeholder="https://....png">
                        </div>
                    </div>
                </div>

                <div id="tab-content-cauldron-rewards-3" class="tab-content hidden">
                    <div class="quest-card">
                        <h3 style="margin-top:0;">Награды для Топ-20 (Уровень 3)</h3>
                        <div id="top-rewards-container-3"></div>
                        <button type="button" id="add-top-reward-btn-3" data-level="3" class="admin-action-btn" style="background-color: var(--action-color); width: 100%; margin-top: 15px;">
                            <i class="fa-solid fa-plus"></i> Добавить награду за место
                        </button>
                    </div>
                    <div class="quest-card" style="margin-top: 15px;">
                        <h3 style="margin-top:0;">Награда для остальных (Уровень 3)</h3>
                        <div class="admin-form">
                            <label>Название предмета</label>
                            <input type="text" name="default_reward_name_3" placeholder="AWP | Dragon Lore">
                            <label>URL изображения</label>
                            <input type="text" name="default_reward_image_url_3" placeholder="https://....png">
                        </div>
                    </div>
                </div>

                <div id="tab-content-cauldron-rewards-4" class="tab-content hidden">
                    <div class="quest-card">
                        <h3 style="margin-top:0;">Награды для Топ-20 (Уровень 4)</h3>
                        <div id="top-rewards-container-4"></div>
                        <button type="button" id="add-top-reward-btn-4" data-level="4" class="admin-action-btn" style="background-color: var(--action-color); width: 100%; margin-top: 15px;">
                            <i class="fa-solid fa-plus"></i> Добавить награду за место
                        </button>
                    </div>
                    <div class="quest-card" style="margin-top: 15px;">
                        <h3 style="margin-top:0;">Награда для остальных (Уровень 4)</h3>
                        <div class="admin-form">
                            <label>Название предмета</label>
                            <input type="text" name="default_reward_name_4" placeholder="Butterfly Knife | Fade">
                            <label>URL изображения</label>
                            <input type="text" name="default_reward_image_url_4" placeholder="https://....png">
                        </div>
                    </div>
                </div>

                <div id="tab-content-cauldron-distribution" class="tab-content hidden">
                    <div class="quest-card">
                        <h3 style="margin: 0 0 15px;">Все участники по вкладу</h3>
                        <div id="cauldron-distribution-list">
                            <p style="text-align: center; color: var(--text-color-muted);">Здесь будет список участников...</p>
                        </div>
                    </div>
                </div>

                <div class="quest-card" style="margin-top: 20px;">
                    <button type="submit" class="admin-action-btn approve" style="width: 100%;">Сохранить все настройки</button>
                </div>
            </form>
        </div>
    </main>

    <div id="password-prompt-overlay" class="modal-overlay hidden">
        <div class="prompt-modal">
            <h3>Введите пароль</h3>
            <input type="password" id="password-prompt-input" class="admin-form" style="margin-top: 15px;">
            <div class="prompt-actions">
                <button id="password-prompt-cancel" class="cancel-btn">Отмена</button>
                <button id="password-prompt-confirm" class="confirm-btn">Войти</button>
            </div>
        </div>
    </div>
    <div id="submissions-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title" class="modal-title">Заявки</h2>
                <button id="modal-close-btn" class="modal-close-btn">&times;</button>
            </div>
            <div id="modal-body" class="modal-body"></div>
        </div>
    </div>

    <div id="edit-roulette-prize-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Редактировать приз</h2>
                    <button class="modal-close-btn" data-close-modal="edit-roulette-prize-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="edit-roulette-prize-form" class="admin-form">
                        <input type="hidden" name="prize_id">
                        <label>Название Twitch награды (триггер)</label>
                        <input type="text" name="reward_title" required>
                        <label>Название скина</label>
                        <input type="text" name="skin_name" required>
                        <label>URL картинки скина</label>
                        <input type="text" name="image_url" required>
                        <label>Вес шанса</label>
                        <input type="number" step="0.1" name="chance_weight" required>
                        <label>Количество в наличии</label>
                        <input type="number" name="quantity" required min="0">
                        <div class="prompt-actions" style="margin-top: 20px;">
                            <button type="button" class="cancel-btn" data-close-modal="edit-roulette-prize-modal">Отмена</button>
                            <button type="submit" class="confirm-btn">Сохранить</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    <div id="generic-prompt-overlay" class="modal-overlay hidden">
        <div class="prompt-modal">
            <h3 id="generic-prompt-title">Редактировать</h3>
            <input type="text" id="generic-prompt-input" class="admin-form" style="margin-top: 15px;">
            <div class="prompt-actions">
                <button id="generic-prompt-cancel" class="cancel-btn">Отмена</button>
                <button id="generic-prompt-confirm" class="confirm-btn">Сохранить</button>
            </div>
        </div>
    </div>
    <div id="winners-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Победители розыгрышей</h2>
                <button id="winners-modal-close-btn" class="modal-close-btn">&times;</button>
            </div>
            <div id="winners-modal-body" class="modal-body"></div>
        </div>
    </div>
    <div id="sleep-prompt-overlay" class="modal-overlay hidden">
        <div class="prompt-modal">
            <h3>Уложить бота спать?</h3>
            <p style="font-size: 14px; color: var(--text-color-muted);">0 = спать вечно (до ручного включения)</p>
            <input type="number" id="sleep-minutes-input" class="admin-form" style="margin-top: 15px;" placeholder="Количество минут..." value="60">
            <div class="prompt-actions">
                <button id="sleep-prompt-cancel" class="cancel-btn">Отмена</button>
                <button id="sleep-prompt-confirm" class="confirm-btn">Уложить</button>
            </div>
        </div>
    </div>
    <div id="twitch-purchases-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="twitch-purchases-title" class="modal-title">Покупки награды</h2>
                <button id="refresh-purchases-btn" title="Обновить список"><i class="fa-solid fa-rotate-right"></i></button>
                 <button id="delete-all-purchases-btn" class="admin-action-btn reject hidden" style="margin-left: auto; margin-right: 10px; padding: 6px 10px; font-size: 12px;" title="Удалить все покупки для этой награды"><i class="fa-solid fa-trash-can"></i></button>
                <button class="modal-close-btn" data-close-modal="twitch-purchases-modal">&times;</button>
            </div>
            <div id="twitch-purchases-body" class="modal-body"></div>
        </div>
    </div>
    <div id="twitch-reward-settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="twitch-settings-title" class="modal-title">Настройки награды</h2>
                <button class="modal-close-btn" data-close-modal="twitch-reward-settings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="twitch-reward-settings-form" class="admin-form">
                    <input type="hidden" name="reward_id">
                    <div class="setting-item">
                        <span class="setting-label">Активна в логах</span>
                        <label class="toggle-switch"><input type="checkbox" name="is_active"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Уведомлять админа</span>
                        <label class="toggle-switch"><input type="checkbox" name="notify_admin"><span class="toggle-slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Показывать сообщение от пользователя</span>
                        <label class="toggle-switch"><input type="checkbox" name="show_user_input"><span class="toggle-slider"></span></label>
                    </div>
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--divider-glass-color);">
                        <label>Условие для выдачи (необязательно)</label>
                        <select name="condition_type">
                            <option value="">Нет условия</option>
                            <option value="twitch_messages_session">Сообщения Twitch (за стрим)</option>
                            <option value="twitch_messages_week">Сообщения Twitch (за неделю)</option>
                            <option value="twitch_messages_month">Сообщения Twitch (за месяц)</option>
                        </select>
                        <input type="number" name="target_value" placeholder="Например, 500 (сообщений)" style="margin-top: 10px;">
                    </div>
                    <div style="margin-top: 15px;" id="legacy-promocode-field-wrapper">
                      <label for="promocode-amount-input">Сумма промокода (звёзды)</label>
                      <input type="number" id="promocode-amount-input" name="promocode_amount" placeholder="Например, 10" required>
                    </div>

                    <div class="admin-feature-6971" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--divider-glass-color);">
                        <label for="reward-type-select">Тип награды</label>
                        <select id="reward-type-select" name="reward_type">
                            <option value="promocode">Промокод (Звёзды)</option>
                            <option value="tickets">Билеты (Розыгрыши)</option>
                        </select>
                        <label for="reward-amount-input" style="margin-top: 10px;">Количество</label>
                        <input type="number" id="reward-amount-input" name="reward_amount" placeholder="Например, 10" required>
                        
                        <label for="reward-sort-order-input" style="margin-top: 10px;">Порядковый номер (#)</label>
                        <input type="number" id="reward-sort-order-input" name="sort_order" placeholder="Пусто = в конец">
                    </div>
                    
                    <div class="prompt-actions" style="margin-top: 20px;">
                        <button type="button" class="cancel-btn" data-close-modal="twitch-reward-settings-modal">Отмена</button>
                        <button type="submit" class="confirm-btn">Сохранить</button>
                    </div>
                    <div style="margin-top: 25px; border-top: 1px solid var(--divider-glass-color); padding-top: 15px;">
                        <button type="button" id="delete-twitch-reward-btn" class="admin-action-btn reject" style="width: 100%;">Удалить награду</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
  <div id="admin-user-search-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="admin-user-search-title" class="modal-title">Выберите пользователя</h2>
            <button class="modal-close-btn" data-close-modal="admin-user-search-modal">&times;</button>
        </div>
        <div class="modal-body">
            <form id="admin-user-search-form" class="admin-form" style="gap: 5px;">
                <input type="text" id="admin-user-search-input" placeholder="Введите ID, TG-ник или Twitch-ник...">
            </form>
            <div id="admin-user-search-results" style="margin-top: 15px; max-height: 40vh; overflow-y: auto;">
                <p style="text-align: center; color: var(--text-color-muted);">Начните вводить для поиска...</p>
            </div>
        </div>
    </div>
</div>
  <div id="admin-entity-select-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="admin-entity-select-title" class="modal-title">Выберите что выполнить</h2>
                <button class="modal-close-btn" data-close-modal="admin-entity-select-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs-container" style="margin-bottom: 0;">
                    <button class="tab-button active" data-tab="quest">Квест</button>
                    <button class="tab-button" data-tab="challenge">Челлендж</button>
                </div>
                <div id="admin-entity-list-quest" class="tab-content active entity-list-container" style="padding-top: 15px; max-height: 40vh; overflow-y: auto;">
                    <i>Загрузка квестов...</i>
                </div>
                <div id="admin-entity-list-challenge" class="tab-content hidden entity-list-container" style="padding-top: 15px; max-height: 40vh; overflow-y: auto;">
                    <i>Загрузка челленджей...</i>
                </div>
            </div>
        </div>
    </div>
    <div id="admin-promocode-select-modal" class="modal-overlay hidden">
          </div>  

    <script src="admin.js" defer></script>
</body>
</html>
