/* =========================================
   1. ОСНОВНЫЕ ПЕРЕМЕННЫЕ И ТЕМЫ
   ========================================= */
/* Добавить в САМОЕ НАЧАЛО файла */
* {
    box-sizing: border-box;
}
:root {
  --text-color: #f0f0f5;
  --text-color-muted: #a09cb8;
  --danger-color: #ff4d4d;
  --surface-primary: rgba(18, 16, 33, 0.7);
  --surface-secondary: #2a2738;
  --border-color: rgba(60, 56, 82, 0.5);
  --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  --accent-glow: #00e5ff;
  --backdrop-blur: 12px;
  --accent-secondary: #d433ff;
}

/* --- ТЕМА: HALLOWEEN --- */
body[data-theme="halloween"] {
  --bg-image: url('https://i.postimg.cc/9fbNYP3M/738e137ac94b6294a9f6ad979a59dc34.jpg');
  --primary-color: #ff9500;
  --action-color: #bf5af2;
  --glow-color: rgba(255, 149, 0, 0.4);
}

/* --- ТЕМА: НОВЫЙ ГОД --- */
body[data-theme="new_year"] {
  --bg-image: url('https://i.postimg.cc/fT4nLKDK/f93acc97afccb488268433623ce95ef3.jpg');
  
  /* Морозно-золотая палитра */
  --primary-color: #b3e5fc;       /* Ледяной голубой */
  --action-color: #ffca28;        /* Золото */
  --glow-color: rgba(179, 229, 252, 0.6);
  --text-color: #ffffff;
  --text-color-muted: #d1d9e6;
  
  --surface-primary: rgba(20, 40, 65, 0.65); 
  --surface-secondary: rgba(255, 255, 255, 0.1);
  --border-color: rgba(179, 229, 252, 0.3);
}

/* --- ТЕМА: КЛАССИКА --- */
body[data-theme="classic"] {
  --bg-image: url('https://i.postimg.cc/PqQ0Fsw6/b4118ce3d4125c4588267c1c75de9a1a.jpg');
  --primary-color: #00f2ea;
  --action-color: #d433ff;
  --glow-color: rgba(0, 242, 234, 0.4);
}

/* =========================================
   2. ГЛОБАЛЬНЫЕ НАСТРОЙКИ (ФОН И СКРОЛЛ)
   ========================================= */
html, body {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden !important; /* Принудительно запрещаем скролл вбок */
    position: relative; /* Помогает держать элементы в рамках */
}
body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
    overflow-x: hidden;
    background-color: #0d1117; 
    
    /* Настройки фона для четкости */
    background-repeat: no-repeat;
    background-position: center center;
    background-attachment: fixed;
    background-size: cover;
    
    /* Убираем мыло */
    -webkit-font-smoothing: antialiased;
    image-rendering: -webkit-optimize-contrast; 
    
    /* Чтобы футер не перекрывал контент, добавляем отступ снизу для всего body */
    padding-bottom: 80px; 
}

body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.6); /* Затемнение фона */
    z-index: -1;
}

body::after {
    content: '';
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-image: var(--bg-image);
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    /* Убрал filter: blur, так как он делает картинку мыльной */
    z-index: -2;
    transition: background-image 0.5s ease;
}

/* =========================================
   3. ЧАСТИЦЫ И АНИМАЦИИ
   ========================================= */
.particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; overflow: hidden; pointer-events: none; }
.particle { position: absolute; background: var(--primary-color); border-radius: 50%; animation: fall 15s infinite linear; opacity: 0; box-shadow: 0 0 10px var(--glow-color), 0 0 15px var(--glow-color); }
@keyframes fall { 0% { transform: translateY(-10vh) translateX(0) scale(1); opacity: 0; } 10% { opacity: 0.8; } 90% { opacity: 0.8; } 100% { transform: translateY(100vh) translateX(var(--drift, 0px)) scale(0.5); opacity: 0; } }

/* Настройки частиц */
.particle:nth-child(1) { width: 4px; height: 4px; left: 10%; animation-duration: 12s; animation-delay: 1s; --drift: 50px; }
.particle:nth-child(2) { width: 2px; height: 2px; left: 20%; animation-duration: 18s; animation-delay: 3s; --drift: -30px; }
.particle:nth-child(3) { width: 5px; height: 5px; left: 30%; animation-duration: 10s; animation-delay: 5s; --drift: 40px; }
.particle:nth-child(4) { width: 3px; height: 3px; left: 40%; animation-duration: 22s; animation-delay: 2s; --drift: -60px; }
.particle:nth-child(5) { width: 4px; height: 4px; left: 50%; animation-duration: 14s; animation-delay: 8s; --drift: 20px; }
.particle:nth-child(6) { width: 2px; height: 2px; left: 60%; animation-duration: 17s; animation-delay: 4s; --drift: -50px; }
.particle:nth-child(7) { width: 5px; height: 5px; left: 70%; animation-duration: 11s; animation-delay: 6s; --drift: 30px; }
.particle:nth-child(8) { width: 3px; height: 3px; left: 80%; animation-duration: 20s; animation-delay: 0s; --drift: -40px; }
.particle:nth-child(9) { width: 4px; height: 4px; left: 90%; animation-duration: 16s; animation-delay: 7s; --drift: 60px; }
.particle:nth-child(10) { width: 3px; height: 3px; left: 15%; animation-duration: 19s; animation-delay: 9s; --drift: -20px; }
.particle:nth-child(11) { width: 5px; height: 5px; left: 25%; animation-duration: 13s; animation-delay: 11s; --drift: 50px; }
.particle:nth-child(12) { width: 2px; height: 2px; left: 35%; animation-duration: 21s; animation-delay: 13s; --drift: -30px; }
.particle:nth-child(13) { width: 4px; height: 4px; left: 45%; animation-duration: 15s; animation-delay: 10s; --drift: 40px; }
.particle:nth-child(14) { width: 3px; height: 3px; left: 55%; animation-duration: 23s; animation-delay: 12s; --drift: -60px; }
.particle:nth-child(15) { width: 5px; height: 5px; left: 65%; animation-duration: 12s; animation-delay: 14s; --drift: 20px; }

/* Ведьма и Фласка */
.flying-witch { display: none; position: fixed; bottom: 65px; left: 0; width: 50px; height: auto; z-index: 101; pointer-events: none; transform: translateX(-55px); clip-path: circle(48%); }
body[data-theme="halloween"] .flying-witch { display: block; animation: fly-across 620s linear 3s infinite; }
@keyframes fly-across { 0% { transform: translateX(-55px) scaleX(1); } 1.6% { transform: translateX(100vw) scaleX(1); } 1.7% { transform: translateX(100vw) scaleX(-1); } 50% { transform: translateX(100vw) scaleX(-1); } 51.6% { transform: translateX(-55px) scaleX(-1); } 51.7% { transform: translateX(-55px) scaleX(1); } 100% { transform: translateX(-55px) scaleX(1); } }

.flask-animation { position: fixed; width: 60px; height: auto; z-index: 200; pointer-events: none; opacity: 0; transform: scale(0); transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; }
.flask-animation.animate { --start-x: 0px; --start-y: 0px; --end-x: 0px; --end-y: 0px; animation: fly-into-cauldron 1.2s cubic-bezier(0.5, -0.5, 1, 1); }
@keyframes fly-into-cauldron { 0% { opacity: 1; transform: translate(var(--start-x), var(--start-y)) scale(1) rotate(0deg); } 30% { transform: translate(var(--start-x), var(--start-y)) scale(1.2) rotate(10deg); } 100% { opacity: 0; transform: translate(var(--end-x), var(--end-y)) scale(0.2) rotate(720deg); } }
@keyframes cauldron-pulse { 0% { transform: scale(1); filter: brightness(1); } 50% { transform: scale(1.05); filter: brightness(1.7) drop-shadow(0 0 25px var(--primary-color)); } 100% { transform: scale(1); filter: brightness(1); } }

/* =========================================
   4. СТРУКТУРА СТРАНИЦЫ
   ========================================= */
.loader-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 300; display: flex; align-items: center; justify-content: center; }
.spinner { width: 40px; height: 40px; border: 4px solid rgba(255, 255, 255, 0.2); border-top-color: var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.page-header, .page-layout, .contribution-section, .leaderboard-section, .default-reward-section, .theme-switcher, .admin-notice, .event-timer {
    position: relative;
    z-index: 2;
}

/* ЗАГОЛОВОК СТРАНИЦЫ (Исправлен цвет) */
.page-header { display: flex; justify-content: center; align-items: center; margin-bottom: 5px; padding-top: 15px; }
.page-header-title { 
    margin: 0; 
    font-size: 17px; 
    font-weight: 700; 
    text-align: center;
    color: var(--text-color) !important; /* Принудительно цвет темы */
    text-shadow: 0 2px 5px rgba(0,0,0,0.5); /* Тень для читаемости */
}

/* КНОПКА "КАК ИГРАТЬ" */
.rules-button-container { text-align: center; margin-bottom: 20px; position: relative; z-index: 201; }
.rules-button { background: linear-gradient(45deg, var(--action-color), var(--primary-color)); color: white; border: none; padding: 10px 25px; border-radius: 20px; font-weight: 700; font-size: 14px; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); transition: all 0.3s ease; }
.rules-button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px var(--glow-color); }
.rules-button.highlight { animation: pulse-glow 1.5s infinite; }
@keyframes pulse-glow { 0% { box-shadow: 0 0 5px var(--glow-color), 0 0 10px var(--glow-color); } 50% { box-shadow: 0 0 20px var(--glow-color), 0 0 30px var(--glow-color); } 100% { box-shadow: 0 0 5px var(--glow-color), 0 0 10px var(--glow-color); } }

/* ДАТА / ТАЙМЕР (Исправлен стиль: без фона) */
.event-timer {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-bottom: 15px;
    padding: 5px;
    
    /* Сброс стилей фона */
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    
    text-align: center;
    font-size: 0.9em;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8); /* Тень для текста */
}
.event-timer i { color: var(--primary-color); }
.event-timer span { color: var(--text-color); }

/* ОСНОВНОЙ ЛЕЙАУТ (С отступом снизу) */
.page-layout { 
    display: flex; 
    flex-direction: column; 
    gap: 15px; 
    padding-bottom: 40px; /* Чтобы контент не упирался в футер */
}
.subsection-title { text-align: center; font-weight: 600; font-size: 14px; margin: 0 0 10px 0; color: var(--text-color-muted); }

/* СЕКЦИЯ КОТЛА */
.top-section { text-align: center; }
.cauldron-image-wrapper img {
    max-height: 35vh;
    max-width: 70%;
    width: auto;
    height: auto;
    animation: float 4s ease-in-out infinite;
    margin-bottom: 10px;
    transition: transform 0.5s ease;
}
.cauldron-image-wrapper img.pulse { animation: float 4s ease-in-out infinite, cauldron-pulse 0.7s ease-out; }
@keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-12px); } 100% { transform: translateY(0px); } }

.progress-bar-container { width: 100%; background-color: rgba(0,0,0,0.3); border-radius: 8px; height: 10px; border: 1px solid var(--border-color); overflow: hidden; }
.progress-bar-fill { height: 100%; background: linear-gradient(90deg, var(--action-color), var(--primary-color)); border-radius: 8px; transition: width 0.5s ease-out, background 0.5s ease; box-shadow: 0 0 10px var(--glow-color); }
.progress-text { margin-top: 8px; font-size: 13px; font-weight: 500; color: var(--text-color-muted); }

/* ОБЩИЕ БЛОКИ */
.contribution-section, .leaderboard-section, .default-reward-section { 
    background-color: var(--surface-primary); 
    border: 1px solid var(--border-color); 
    border-radius: 16px; 
    padding: 20px; 
    backdrop-filter: blur(10px); 
    box-shadow: 0 8px 32px rgba(0,0,0,0.3); 
}

/* ВКЛАД */
.contribution-section p { margin: 0 0 15px 0; font-size: 14px; text-align: center; color: var(--text-color-muted); }
.contribution-section p strong { color: var(--text-color); font-weight: 600; }
#contribution-form { display: flex; gap: 10px; flex-wrap: wrap; position: relative; }
#tickets-input { flex: 1 1 180px; padding: 12px; border-radius: 10px; border: 1px solid var(--border-color); background-color: var(--surface-secondary); color: white; font-size: 16px; }
#contribution-form button { flex: 1 1 120px; background: linear-gradient(45deg, var(--action-color), var(--primary-color)); border: none; padding: 12px 18px; border-radius: 10px; color: black; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
#contribution-form button:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--glow-color); }
#contribution-form button:disabled { background: #555; cursor: not-allowed; transform: none; box-shadow: none; }
.error-message { color: var(--danger-color); font-size: 13px; margin-top: 10px; font-weight: 500; }

/* ЛИДЕРБОРД */
.leaderboard-header { display: grid; grid-template-columns: 40px 1fr 70px 80px; gap: 10px; padding: 0 5px 10px; border-bottom: 1px solid var(--border-color); font-size: 11px; font-weight: 500; color: var(--text-color-muted); text-transform: uppercase; letter-spacing: 0.5px; }
.align-right { text-align: right; }
.centered-header { text-align: center; }
.leaderboard-row { display: grid; grid-template-columns: 40px 1fr 70px 80px; gap: 10px; padding: 12px 5px; align-items: center; border-bottom: 1px solid var(--border-color); transition: background-color 0.2s ease; }
.leaderboard-row:last-child { border-bottom: none; }
.leaderboard-row.is-top-3 { font-weight: 700; }
.leaderboard-row:hover { background-color: rgba(255, 255, 255, 0.05); }
.leaderboard-row .rank { font-weight: 700; color: var(--text-color-muted); font-size: 14px; text-align: center; }
.leaderboard-row.is-top-3 .rank { color: var(--primary-color); }

/* ИСПРАВЛЕНИЕ ЦВЕТА НИКА */
.leaderboard-row .player { 
    font-weight: 500; 
    white-space: nowrap; 
    overflow: hidden; 
    text-overflow: ellipsis; 
    font-size: 0.9em;
    color: var(--text-color) !important; /* Белый/светлый принудительно */
}

.leaderboard-row .prize-image-container { display: flex; justify-content: center; align-items: center; padding-left: 10px; }
.leaderboard-row .prize-image { width: 50px; height: 50px; object-fit: contain; }
.leaderboard-row .contribution { font-weight: 600; color: var(--text-color); text-align: right; font-size: 0.85em; padding-right: 0; }
.image-zoom-container { position: relative; cursor: pointer; display: inline-block; flex-shrink: 0; }
.image-zoom-container .zoom-icon { position: absolute; bottom: 2px; right: 2px; width: 20px; height: 20px; background-color: rgba(0, 0, 0, 0.6); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.2s ease; opacity: 0; }
.image-zoom-container:hover .zoom-icon { opacity: 1; transform: scale(1.1); }

/* =========================================
   5. НАГРАДЫ ДЛЯ ОСТАЛЬНЫХ (НОВЫЙ СТИЛЬ)
   ========================================= */
/* Контейнер */
.tier-rewards-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
    /* Отступ слева и справа, как просили */
    padding: 0 15px 30px; 
}

/* Общий стиль карточки */
.tier-card {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 10px 15px;
    border-radius: 16px;
    position: relative;
    overflow: hidden;
    min-height: 60px;
    transition: transform 0.2s;
}
.tier-card:active { transform: scale(0.98); }

/* Элементы внутри карточки */
.tier-info { display: flex; align-items: center; gap: 15px; width: 100%; z-index: 2; }
.tier-image { width: 42px; height: 42px; object-fit: contain; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
.tier-name { font-size: 12px; font-weight: 600; line-height: 1.2; }
.tier-range-badge {
    position: absolute;
    top: 10%;
    right: 15px;
    transform: translateY(-50%);
    font-size: 9px;
    font-weight: 800;
    opacity: 0.6;
}

/* --- ТЕМА: HALLOWEEN (Мрачные карточки) --- */
[data-theme="halloween"] .tier-card {
    background: linear-gradient(90deg, rgba(40, 20, 0, 0.9), rgba(20, 10, 0, 0.8));
    border: 1px solid #ff6600;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}
[data-theme="halloween"] .tier-name { color: #ffe5b4; }
[data-theme="halloween"] .tier-range-badge { color: #ff6600; }
[data-theme="halloween"] .tier-card.tier-gold { border-left: 5px solid #FFD700; }
[data-theme="halloween"] .tier-card.tier-silver { border-left: 5px solid #C0C0C0; }
[data-theme="halloween"] .tier-card.tier-bronze { border-left: 5px solid #CD7F32; }

/* --- ТЕМА: CLASSIC (Магические карточки) --- */
[data-theme="classic"] .tier-card {
    background: rgba(40, 0, 60, 0.6);
    border: 1px solid rgba(180, 100, 255, 0.3);
    backdrop-filter: blur(10px);
}
[data-theme="classic"] .tier-name { color: #e0ccff; }
[data-theme="classic"] .tier-range-badge { color: #b366ff; }
[data-theme="classic"] .tier-card.tier-gold { box-shadow: inset 10px 0 20px -10px rgba(255, 215, 0, 0.3); }
[data-theme="classic"] .tier-card.tier-silver { box-shadow: inset 10px 0 20px -10px rgba(192, 192, 192, 0.3); }
[data-theme="classic"] .tier-card.tier-bronze { box-shadow: inset 10px 0 20px -10px rgba(205, 127, 50, 0.3); }

/* --- ТЕМА: NEW YEAR (Ледяные карточки БЕЗ РАМОК) --- */
[data-theme="new_year"] .tier-card {
    border: none !important; /* Убираем рамку */
    background: rgba(255, 255, 255, 0.12); /* Стекло */
    backdrop-filter: blur(8px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    border-bottom: 1px solid rgba(255, 255, 255, 0.15) !important; /* Тонкая линия снизу */
}
[data-theme="new_year"] .tier-name { 
    color: #fff; 
    text-shadow: 0 2px 4px rgba(0,0,0,0.5); 
}
[data-theme="new_year"] .tier-range-badge { 
    color: #fff; 
    background: rgba(0,0,0,0.3);
    padding: 2px 8px;
    border-radius: 6px;
}
/* Градиент вместо цветной рамки слева */
[data-theme="new_year"] .tier-card.tier-gold { background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), rgba(255,255,255,0.05)); }
[data-theme="new_year"] .tier-card.tier-silver { background: linear-gradient(90deg, rgba(192, 192, 192, 0.15), rgba(255,255,255,0.05)); }
[data-theme="new_year"] .tier-card.tier-bronze { background: linear-gradient(90deg, rgba(205, 127, 50, 0.15), rgba(255,255,255,0.05)); }


/* =========================================
   6. ФУТЕР, МОДАЛКИ И ПРОЧЕЕ
   ========================================= */
.hidden { display: none !important; }

/* ФУТЕР */
.app-footer {
    display: flex;
    justify-content: space-around;
    align-items: center;
    background-color: rgba(28, 28, 30, 0.85); 
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    z-index: 9999;
    padding-top: 8px;
    padding-bottom: calc(8px + env(safe-area-inset-bottom));
    box-sizing: border-box;
    height: auto;
}
.footer-item {
    display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px;
    color: #8E8E93; text-decoration: none; flex: 1; cursor: pointer; background: transparent; border: none; padding: 0; margin: 0;
    font-family: var(--font-main); font-size: 10px; line-height: 1; font-weight: 500; transition: all 0.2s ease;
}
.footer-item .icon-wrapper { display: flex; justify-content: center; align-items: center; width: 24px; height: 24px; font-size: 22px; position: relative; transition: transform 0.2s ease, color 0.2s ease; }
.footer-item.active { color: #FFFFFF; }
.footer-item.active span { font-weight: 600; }
.footer-item.active .icon-wrapper { color: #34c759; transform: translateY(-2px); text-shadow: 0 0 12px rgba(52, 199, 89, 0.6); }
.footer-item.active .icon-wrapper::before { content: ''; position: absolute; top: -8px; width: 20px; height: 2px; background-color: #34c759; border-radius: 2px; box-shadow: 0 0 5px rgba(52, 199, 89, 0.8); }

/* МОДАЛКИ */
/* =========================================
   6. ФУТЕР, МОДАЛКИ И ПРОЧЕЕ
   ========================================= */

/* МОДАЛКИ (ИСПРАВЛЕНО ЦЕНТРИРОВАНИЕ) */
.modal-overlay { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(10, 10, 20, 0.8); 
    z-index: 250; 
    
    display: flex; 
    /* 1. БЫЛО center, СТАЛО flex-start -> прижимаем к верху */
    align-items: flex-start;     
    justify-content: center; 
    
    padding: 15px; 
    /* 2. Отступ сверху (регулируй высоту здесь) */
    padding-top: 60px; 
    /* 3. Отступ снизу (чтобы не наезжало на нижний бар) */
    padding-bottom: 90px;
    
    backdrop-filter: blur(var(--backdrop-blur)); 
}

.modal-content { 
    background-color: var(--surface-secondary); 
    border: 1px solid var(--action-color); 
    padding: 0; 
    border-radius: 16px; 
    width: 100%; 
    max-width: 375px; 
    box-shadow: 0 10px 40px rgba(0,0,0,0.7); 
    display: flex; 
    flex-direction: column; 
    
    /* 4. Высота теперь заполняет доступное пространство между отступами */
    max-height: 100%; 
    
    margin: 0 auto; 
    transform: none;
}

.modal-header { padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
.modal-header h3 { margin: 0; color: var(--primary-color); }
.modal-close-btn { background: none; border: none; color: var(--text-color-muted); font-size: 24px; cursor: pointer; }

.modal-body { 
    overflow-y: auto; 
    padding: 20px; 
    line-height: 1.6; 
    color: #ffffff; 
}

.modal-form { display: flex; flex-direction: column; gap: 15px; }
.modal-form input, .modal-form textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--surface-secondary); color: var(--text-color); font-size: 16px; font-family: var(--font-main); color-scheme: dark; }
.modal-form button { background: var(--primary-color); border: none; padding: 12px; border-radius: 10px; color: #000; font-size: 16px; font-weight: 600; cursor: pointer; transition: filter 0.2s ease; }
.modal-form button:hover { filter: brightness(1.1); }
.modal-form label { font-size: 14px; color: var(--text-color-muted); margin-bottom: -10px; }

/* === НОВЫЕ СТИЛИ ДЛЯ СПИСКА НАГРАД (ВСТАВИТЬ СЮДА ЖЕ) === */

/* Строка награды */
.modal-reward-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    margin-bottom: 8px;
    min-height: 56px;
}

/* Картинка (с иконкой зума при наведении) */
.modal-reward-img {
    width: 40px;
    height: 40px;
    object-fit: contain;
    flex-shrink: 0;
    cursor: zoom-in; /* Курсор лупы */
    background: rgba(0,0,0,0.2);
    border-radius: 6px;
    padding: 2px;
    transition: transform 0.2s;
}
.modal-reward-img:hover { transform: scale(1.1); background: rgba(255,255,255,0.1); }

/* Название (полный текст) */
.modal-reward-name {
    font-size: 13px;
    font-weight: 500;
    color: #ffffff;
    line-height: 1.3;
    white-space: normal;    /* Разрешаем перенос */
    overflow: visible;      /* Показываем всё */
    word-break: break-word; /* Переносим длинные слова */
    flex: 1;
}

.modal-reward-place { width: 30px; text-align: center; flex-shrink: 0; font-weight: 700; color: var(--action-color); }

/* Экран блокировки уровня */
.locked-level-container { text-align: center; padding: 30px 10px; color: var(--text-color-muted); }
.lock-icon-large { font-size: 48px; margin-bottom: 20px; color: var(--danger-color); opacity: 0.8; }
.modal-progress-wrapper { width: 100%; background: rgba(0,0,0,0.3); height: 10px; border-radius: 5px; margin: 15px 0 5px 0; overflow: hidden; border: 1px solid var(--border-color); }
.modal-progress-fill { height: 100%; background: linear-gradient(90deg, var(--danger-color), var(--action-color)); transition: width 0.5s ease; }
/* УТИЛИТЫ */
.tutorial-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: 200; transition: opacity 0.3s ease; }
.image-viewer-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px); z-index: 350; display: flex; align-items: center; justify-content: center; box-sizing: border-box; padding: 20px 20px 80px 20px; }
.viewer-close-btn { position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 40px; cursor: pointer; line-height: 1; padding: 5px; text-shadow: 0 0 5px black; }
.viewer-content-wrapper { position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; max-width: 100%; max-height: 100%; }
.viewer-image { max-width: 100%; max-height: 100%; object-fit: contain; }
.viewer-caption { position: absolute; bottom: -50px; left: 50%; transform: translateX(-50%); background-color: rgba(18, 16, 33, 0.8); color: #f0f0f5; padding: 8px 16px; border-radius: 12px; font-size: 14px; font-weight: 500; white-space: nowrap; border: 1px solid rgba(60, 56, 82, 0.5); backdrop-filter: blur(5px); transition: opacity 0.3s ease; opacity: 0; }
.image-viewer-overlay:not(.hidden) .viewer-caption { opacity: 1; }
@media (max-width: 768px) {
    .main-container {
        padding: 15px;
    }

    header h1 {
        font-size: 2em;
    }

    .cauldron-container {
        width: 200px;
        height: 200px;
    }
   /* --- ИСПРАВЛЕННАЯ ГИРЛЯНДА НА ТЕЛЕФОН --- */
    .mobile-garland {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 999;
        /* УБРАНО: background: #000; - это создавало черный фон */
        /* УБРАНО: opacity: 0.6; - это делало все тусклым */
        /* УБРАНО: mix-blend-mode: screen; - это ломало свечение на мобилках */
        background: transparent; /* Явно указываем прозрачный фон */
    }

    .mobile-light {
        position: absolute;
        /* Немного уменьшил размер самой точки, чтобы свечение было более выраженным */
        width: 8px; 
        height: 8px;
        background: var(--primary-color);
        border-radius: 50%; /* Это делает их круглыми */
        /* Усиленное свечение для компенсации отсутствия темного фона */
        box-shadow: 0 0 15px var(--primary-color),
                    0 0 25px var(--primary-color),
                    0 0 35px var(--primary-color);
        animation: twinkle 1.5s infinite alternate;
        will-change: opacity, transform; /* Оптимизация для мобильных */
    }

    @keyframes twinkle {
        0% {
            opacity: 0.4;
            transform: scale(0.9);
        }
        100% {
            opacity: 1;
            transform: scale(1.1);
        }
    }
}

/* АДМИН-ПАНЕЛЬ */
.admin-notice { background-color: rgba(191, 90, 242, 0.2); color: var(--action-color); padding: 10px; border-radius: 8px; font-size: 13px; font-weight: 500; text-align: center; margin-bottom: 15px; border: 1px solid var(--action-color); display: flex; align-items: center; justify-content: center; gap: 8px; }
.admin-controls { position: fixed; bottom: calc(60px + env(safe-area-inset-bottom) + 15px); left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; align-items: center; gap: 10px; background-color: var(--surface-primary); padding: 5px; border-radius: 25px; border: 1px solid var(--border-color); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); }
.admin-toggle-btn { background: linear-gradient(90deg, #555, #333); color: white; border: none; width: 36px; height: 36px; border-radius: 50%; font-size: 16px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.admin-toggle-btn:hover { transform: scale(1.1); }
.admin-toggle-btn i { transition: transform 0.3s ease; }
.admin-action-buttons { display: none; align-items: center; gap: 5px; }
.admin-controls.expanded .admin-action-buttons { display: flex; }
.admin-controls.expanded .admin-toggle-btn i { transform: rotate(180deg); }
.admin-action-buttons button:not(.theme-btn) { background: linear-gradient(90deg, var(--accent-secondary), #ff70ab); color: white; padding: 8px 18px; border-radius: 18px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3); border: none; font-size: 14px; font-weight: 600; cursor: pointer; transition: transform 0.2s ease; }
.admin-action-buttons button:hover { transform: scale(1.05); }
.theme-switcher { display: flex; gap: 8px; background-color: transparent; padding: 0; border-radius: 20px; border: none; margin: 0; }
.theme-btn { background-color: transparent; border: 2px solid transparent; color: var(--text-color-muted); font-size: 18px; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; }
.theme-btn:hover { color: var(--text-color); background-color: rgba(255, 255, 255, 0.1); }
.theme-btn.active { border-color: var(--primary-color); color: var(--primary-color); }
#save-btn { display: none; }
.admin-controls.edit-mode-active #edit-btn { display: none; }
.admin-controls.edit-mode-active #save-btn { display: block; }
body.edit-mode [data-editable] { cursor: pointer; border: 1px dashed var(--accent-secondary); border-radius: 8px; padding-left: 8px; padding-right: 8px; transition: background-color 0.2s ease; }
body.edit-mode [data-editable]:hover { background-color: rgba(212, 51, 255, 0.1); }

/* АДАПТАЦИЯ НОВОГОДНЕЙ ТЕМЫ (Кнопки и фоны) */
body[data-theme="new_year"] .contribution-section, 
body[data-theme="new_year"] .leaderboard-section, 
body[data-theme="new_year"] .default-reward-section {
    background: linear-gradient(135deg, rgba(30, 60, 90, 0.7), rgba(20, 40, 60, 0.8));
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 10, 30, 0.5), inset 0 0 20px rgba(179, 229, 252, 0.05);
    backdrop-filter: blur(15px);
}
body[data-theme="new_year"] #contribution-form button,
body[data-theme="new_year"] .rules-button {
    background: linear-gradient(180deg, #ffd54f 0%, #ffca28 100%);
    color: #000000; font-weight: 700; text-shadow: none;
    border: 2px solid #ffffff; 
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.6), 0 4px 10px rgba(0, 0, 0, 0.2);
    transform: translateY(0); transition: all 0.2s ease;
}
body[data-theme="new_year"] #contribution-form button:hover,
body[data-theme="new_year"] .rules-button:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(255, 255, 255, 0.8); filter: brightness(1.1); }
body[data-theme="new_year"] #contribution-form button:disabled { background: #555; color: #aaa; border: 1px solid #777; box-shadow: none; transform: none; }

@media (max-width: 768px) {
    body::after { background-attachment: scroll; }
}
/* =========================================
   НОВОГОДНЯЯ ВИДЕО-ГИРЛЯНДА
   ========================================= */

.garland-video {
    display: none;
    
    position: absolute;
    /* Поднимаем еще выше, чтобы провод ушел за экран, а висели только лампы */
    top: -40px; 
    
    left: 0;
    width: 100%;
    
    /* Увеличиваем размер, как просила */
    height: 160px; 
    
    object-fit: cover;
    object-position: top center;
    
    z-index: 999;
    pointer-events: none;
    
    /* === ИСПРАВЛЕНИЕ БЛИКОВ === */
    
    /* 1. Убираем фильтр, который делал "круги" (filter: contrast...) — УДАЛЕНО */
    
    /* 2. Используем plus-lighter. 
       Это лучший режим для неона на темном фоне. 
       Он "съедает" полупрозрачную грязь и оставляет только чистый свет. 
    */
    mix-blend-mode: plus-lighter; 
    
    /* 3. Немного прозрачности (0.9), чтобы смягчить границы, если видео плохого качества */
    opacity: 0.95; 
}

/* Если браузер на телефоне старый и не знает plus-lighter, 
   сработает запасной вариант (screen) */
@supports not (mix-blend-mode: plus-lighter) {
    .garland-video {
        mix-blend-mode: screen;
    }
}

/* Показываем только в теме New Year */
body[data-theme="new_year"] .garland-video {
    display: block;
}

/* --- СТИЛИ ДЛЯ СПИСКА НАГРАД (MODAL) --- */

/* Контейнер табов */
.rewards-tabs {
    display: flex;
    background-color: rgba(0,0,0,0.2);
    border-bottom: 1px solid var(--border-color);
}

/* Кнопка таба */
.rewards-tab-btn {
    flex: 1;
    background: none;
    border: none;
    padding: 12px 5px;
    color: var(--text-color-muted);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    position: relative;
    transition: all 0.2s;
}

/* Активный таб */
.rewards-tab-btn.active {
    color: var(--text-color);
    background-color: rgba(255, 255, 255, 0.05);
    border-bottom: 2px solid var(--primary-color);
}

/* Заблокированный таб */
.rewards-tab-btn.locked {
    opacity: 0.5;
    cursor: not-allowed;
}
.rewards-tab-btn.locked::after {
    content: '\f023'; /* Иконка замка FontAwesome */
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    margin-left: 5px;
    font-size: 10px;
}

/* Стили внутри списка наград модалки */
.modal-rewards-group {
    margin-bottom: 20px;
}
.modal-rewards-title {
    font-size: 14px;
    color: var(--primary-color);
    margin-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 5px;
    text-transform: uppercase;
    font-weight: 700;
}

/* Карточка награды в модалке (упрощенная) */
.modal-reward-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    margin-bottom: 6px;
}
.modal-reward-place {
    font-weight: 700;
    font-size: 12px;
    width: 25px;
    text-align: center;
    color: var(--action-color);
}
.modal-reward-img {
    width: 32px;
    height: 32px;
    object-fit: contain;
}
.modal-reward-name {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-color);
}

/* Заглушка для закрытого уровня */
.locked-level-message {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-color-muted);
}
.locked-level-message i {
    font-size: 40px;
    margin-bottom: 15px;
    color: var(--danger-color);
    opacity: 0.7;
}

/* === ВЫРАВНИВАНИЕ СПИСКА НАГРАД (MODAL) === */

/* Делаем строки наград одинаковыми по высоте и стилю */
.modal-reward-item {
    display: flex;
    align-items: center;
    gap: 12px; /* Чуть больше отступ */
    padding: 8px 12px;
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    margin-bottom: 6px;
    /* Фиксируем минимальную высоту, чтобы строки были ровными */
    min-height: 50px; 
    transition: background 0.2s;
}

.modal-reward-item:hover {
    background: rgba(255,255,255,0.1);
}

/* Фиксируем ширину колонки с местом (#1, #2) */
.modal-reward-place {
    font-weight: 800;
    font-size: 14px;
    width: 35px; /* Фиксированная ширина */
    text-align: center;
    color: var(--action-color);
    flex-shrink: 0; /* Не сжиматься */
}

/* Фиксируем размер картинки */
.modal-reward-img {
    width: 36px;
    height: 36px;
    object-fit: contain;
    flex-shrink: 0;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
}

/* Текст названия всегда в одну строку и обрезается точками, если длинный */
.modal-reward-name {
    font-size: 13px; /* Единый размер шрифта для всех */
    font-weight: 500;
    color: var(--text-color);
    white-space: nowrap;      /* Запрет переноса */
    overflow: hidden;         /* Скрытие лишнего */
    text-overflow: ellipsis;  /* Троеточие */
    flex-grow: 1;
}

/* === ЭКРАН БЛОКИРОВКИ 70% === */

.locked-level-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
    height: 100%;
    color: var(--text-color-muted);
}

.lock-icon-large {
    font-size: 48px;
    margin-bottom: 20px;
    color: var(--danger-color);
    opacity: 0.8;
    animation: pulse-lock 2s infinite;
}

@keyframes pulse-lock {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.lock-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-color);
    margin-bottom: 10px;
}

.lock-desc {
    font-size: 14px;
    margin-bottom: 25px;
    line-height: 1.5;
    max-width: 280px;
}

/* Прогресс-бар внутри модалки */
.modal-progress-wrapper {
    width: 100%;
    max-width: 250px;
    background: rgba(0,0,0,0.3);
    height: 8px;
    border-radius: 4px;
    margin-bottom: 10px;
    position: relative;
    overflow: hidden;
    border: 1px solid var(--border-color);
}

.modal-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--danger-color), var(--action-color));
    width: 0%;
    transition: width 0.5s ease;
}

.modal-progress-text {
    font-size: 12px;
    color: var(--text-color);
    font-weight: 600;
}
.modal-progress-text span {
    color: var(--action-color);
}
/* === БЛОКИРОВКА СКРОЛЛА ФОНА === */
body.no-scroll {
    overflow: hidden !important;
    touch-action: none; /* Для мобильных устройств */
    height: 100vh;      /* Фиксируем высоту */
}
