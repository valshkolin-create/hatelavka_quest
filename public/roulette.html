<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –†—É–ª–µ—Ç–∫–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #1a1a1a; color: #e0e0e0; font-family: monospace; }
        #log { border: 1px solid #444; padding: 10px; height: 90vh; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>–û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –¥–ª—è —Ä—É–ª–µ—Ç–∫–∏...</h1>
    <pre id="log"></pre>

    <script>
        // ‚úÖ –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase
        const SUPABASE_URL = 'https://pyeuckjcrsiaseyqrsek.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5ZXVja2pjcnNpYXNleXFyc2VrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0NzEyOTgsImV4cCI6MjA3MDA0NzI5OH0.srRwuUygiF7jr3-b2AwyRNAmrChlW3Bzp3I-9Ju2TVg';

        const logElement = document.getElementById('log');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —ç–∫—Ä–∞–Ω
        function logMessage(message) {
            console.log(message);
            const content = typeof message === 'object' ? JSON.stringify(message, null, 2) : message;
            logElement.textContent = `${new Date().toLocaleTimeString()}: ${content}\n\n${logElement.textContent}`;
        }

        // --- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase ---
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        logMessage('–ö–ª–∏–µ–Ω—Ç Supabase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.');

        const channel = supabase.channel('roulette-triggers-channel')
            .on(
                'postgres_changes',
                {
                    event: 'INSERT',       // –ù–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏
                    schema: 'public',
                    table: 'roulette_triggers'
                },
                (payload) => {
                    logMessage('üéâ –ü–û–õ–£–ß–ï–ù –ù–û–í–´–ô –°–ò–ì–ù–ê–õ –î–õ–Ø –†–£–õ–ï–¢–ö–ò! üéâ');
                    logMessage(payload);

                    // –ó–¥–µ—Å—å –≤—ã –¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å –≤–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                    // const animationData = payload.new.payload;
                    // startRouletteAnimation(animationData);
                }
            )
            .subscribe((status, err) => {
                // –≠—Ç–∞ —á–∞—Å—Ç—å –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, —É–¥–∞–ª–æ—Å—å –ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
                if (status === 'SUBSCRIBED') {
                    logMessage('‚úÖ –£—Å–ø–µ—à–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É roulette_triggers!');
                } else {
                    logMessage(`–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: ${status}`);
                    if(err) logMessage(err);
                }
            });

        logMessage('–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª...');

    </script>
</body>
</html>
